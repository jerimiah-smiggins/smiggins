var __awaiter=this&&this.__awaiter||function(n,s,c,r){return new(c=c||Promise)(function(t,e){function o(n){try{a(r.next(n))}catch(n){e(n)}}function i(n){try{a(r.throw(n))}catch(n){e(n)}}function a(n){var e;n.done?t(n.value):((e=n.value)instanceof c?e:new c(function(n){n(e)})).then(o,i)}a((r=r.apply(n,s||[])).next())})};let sw_self=self;function canUseNotifications(){return __awaiter(this,void 0,void 0,function*(){return"granted"===(yield navigator.permissions.query({name:"notifications"})).state})}function handleNotification(c){return __awaiter(this,void 0,void 0,function*(){canUseNotifications()||console.log("[SW] recieved message but can't show notif");var e=(null==c?void 0:c.text().split(";"))||[L.notifications.no_content_title,"none","",L.notifications.no_content_body],t=e[0],o=e[1],i=e[2],a=JSON.parse(e.slice(3).join(";"));let s=String(a);switch(o){case"comment":case"quote":case"ping":s=lr(L.notifications[o],{n:a.display_name,u:a.username,c:a.content});break;case"follow":s=lr(L.notifications.followed,{n:a.display_name,u:a.username});break;case"follow_request":s=lr(L.notifications.folreq,{n:a.display_name,u:a.username});break;case"message":s=lr(n(L.notifications.message,a.users-2),{n:a.display_name,u:a.username,c:String(a.users-2)})}sw_self.registration.showNotification(t,{body:s,data:i,icon:location.origin+"/favicon.ico"})})}sw_self.addEventListener("push",function(n){n.waitUntil(handleNotification(n.data))}),console.log("[SW] init");let LANGS={en:{meta:{id:"en",name:"English",fallbacks:[],maintainers:[["trinkey","trinkey"]],past_maintainers:[]},notifications:{followed:"%n (@%u) started following you.",folreq:"%n (@%u) wants to follow you.",comment:"%n (@%u): %c",quote:"%n (@%u): %c",ping:"%n (@%u): %c",message:{0:"%n (@u) messaged you",1:"%n (@u) messaged you and %c other","*":"%n (@u) messaged you and %c others"},no_content_title:"Notification",no_content_body:"No notification context was given."}},en_GB:{meta:{id:"en_GB",name:"English (United Kingdom)",fallbacks:["en"],maintainers:[["trinkey","trinkey"]],past_maintainers:[]},notifications:{followed:"%n (@%u) started following you.",folreq:"%n (@%u) wants to follow you.",comment:"%n (@%u): %c",quote:"%n (@%u): %c",ping:"%n (@%u): %c",message:{0:"%n (@u) messaged you",1:"%n (@u) messaged you and %c other","*":"%n (@u) messaged you and %c others"},no_content_title:"Notification",no_content_body:"No notification context was given."}},es:{meta:{id:"es",name:"Espa√±ol",fallbacks:["en"],maintainers:[["pq-on-tempe2","pquirrel"]],past_maintainers:[]},notifications:{followed:"%n (@%u) started following you.",folreq:"%n (@%u) wants to follow you.",comment:"%n (@%u): %c",quote:"%n (@%u): %c",ping:"%n (@%u): %c",message:{0:"%n (@u) messaged you",1:"%n (@u) messaged you and %c other","*":"%n (@u) messaged you and %c others"},no_content_title:"Notification",no_content_body:"No notification context was given."}}},DEFAULT_LANGUAGE="en",L;function lr(n,e){var t,o,i,a,s={};for([t,o]of Object.entries(e))s[t]=`TEMP_${Math.random()}`,n=n.replaceAll("%"+t,s[t]);for([i,a]of Object.entries(e))n=n.replaceAll(s[i],a);return n}function n(n,e){return n[e]||n["*"]}L=LANGS[DEFAULT_LANGUAGE];