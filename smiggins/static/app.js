function _intToBytes(t,n=1){var o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=t>>8*(n-e-1)&255;return o}function hexToBytes(t){var n=Math.floor(t.length/2),o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=Number("0x"+t.slice(2*e,2*e+2));return o}function buildRequest(e){let t=[],n=0,o=0;for(var a of e){var i;o&&"boolean"!=typeof a&&(t.push(n<<8-o),n=0,o=0),"boolean"==typeof a?(n=(n<<=1)|Number(a),o++):"object"==typeof a?t=a.push?"string"==typeof a[0]?(i=(new TextEncoder).encode(a[0]),t.concat(Array.from(_intToBytes(i.length,Math.floor(a[1]/8))),Array.from(i))):t.concat(Array.from(_intToBytes(a[0],Math.floor(a[1]/8)))):t.concat(Array.from(a)):console.log("invalid type for buildRequest",a),8==o&&(t.push(n),n=0,o=0)}return o&&t.push(n<<8-o),new Uint8Array(t).buffer}let forceDisableKeybinds=!1,navModKeyPressed=!1,_kbReverse={},keybinds={newPost:{defaultKey:"n",name:"Enter Post Box",description:"Lets you send a post from anywhere",callback:()=>{createPostModal()}},loadNewPosts:{defaultKey:"r",name:"Load New Posts",description:"Shows any posts that have been made since the posts were initially loaded",callback:timelineShowNew},topOfTimeline:{defaultKey:"/",name:"Jump to Top",description:"Jumps to the top of the current page",callback:()=>{window.scrollTo(0,0)}},navModifier:{defaultKey:"g",name:"Navigation Modifier",description:"The key that needs to be pressed in order to use the other navigation keybinds",callback:()=>{navModKeyPressed=!0},releaseCallback:()=>{navModKeyPressed=!1}},navAdmin:{defaultKey:"a",modifiers:["nav"],name:"Admin Page",callback:()=>{}},navHome:{defaultKey:"h",modifiers:["nav"],name:"Home",callback:()=>{"home"!==currentPage&&(history.pushState("home","","/"),renderPage("home"))}},navMessages:{defaultKey:"m",modifiers:["nav"],name:"Messages",callback:()=>{}},navNotifications:{defaultKey:"n",modifiers:["nav"],name:"Notifications",callback:()=>{"notifications"!==currentPage&&(history.pushState("notifications","","/notifications/"),renderPage("notifications"))}},navProfile:{defaultKey:"p",modifiers:["nav"],name:"Your Profile",callback:()=>{"user"===currentPage&&getUsernameFromPath()===username||(history.pushState("user","",`/u/${username}/`),renderPage("user"))}},navSettings:{defaultKey:"s",modifiers:["nav"],name:"Settings",callback:()=>{"settings"!==currentPage&&(history.pushState("settings","","/settings/"),renderPage("settings"))}}};function setKeybindKey(e,t,n){let o="";if(n){if(n.nav){var a=_kbGetKey("navModifier");if(a[0]+a.slice(1).split(":")[0]===t.toLowerCase())return!1;o+="nav"}n.alt&&(o&&(o+=","),o+="alt"),n.ctrl&&(o&&(o+=","),o+="ctrl"),n.shift&&(o&&(o+=","),o+="shift")}if("navModifier"===e){o="";for(var i of Object.keys(_kbReverse))if(i.startsWith(t+":nav"))return!1}a=(t="escape"===(t=t.toLowerCase())?"DISABLED":t)+":"+o;return!(a in _kbReverse||(localStorage.setItem("smiggins-keybind-"+e,a),_kbRefreshReverse(),0))}function _kbGetKey(e){var t=keybinds[e],e=localStorage.getItem("smiggins-keybind-"+e);return e||t.defaultKey+":"+(t.modifiers||[]).join(",")}function _kbRefreshReverse(){_kbReverse={};for(var[e,t]of Object.entries(keybinds)){e=_kbGetKey(e);e.startsWith("DISABLED")||(_kbReverse[e]={callback:t.callback,modifiers:e.slice(1).split(":")[1].split(",")})}}function keyHandler(t){if(!forceDisableKeybinds){var n=t.target;if(!n||"INPUT"!==n.tagName&&"TEXTAREA"!==n.tagName){let e="";navModKeyPressed&&(e+="nav"),t.altKey&&(e&&(e+=","),e+="alt"),t.ctrlKey&&(e&&(e+=","),e+="ctrl"),t.shiftKey&&(e&&(e+=","),e+="shift");n=_kbReverse[t.key.toLowerCase()+":"+e];n&&(n.callback(t),t.preventDefault())}}}function keyUpHandler(e){e.key.toLowerCase()+":"===_kbGetKey("navModifier")&&(navModKeyPressed=!1)}onkeydown=keyHandler,onkeyup=keyUpHandler,_kbRefreshReverse();let RE_TLDs="aaa|aarp|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|actor|ad|ads|adult|ae|aeg|aero|aetna|af|afl|africa|ag|agakhan|agency|ai|aig|airbus|airforce|airtel|akdn|al|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|amazon|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|casa|case|cash|casino|cat|catering|catholic|cba|cbn|cbre|cc|cd|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|charity|chase|chat|cheap|chintai|christmas|chrome|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cpa|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dog|domains|dot|download|drive|dtv|dubai|dunlop|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|ericsson|erni|es|esq|estate|et|eu|eurovision|eus|events|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontier|ftr|fujitsu|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gay|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|horse|hospital|host|hosting|hot|hotels|hotmail|house|how|hr|hsbc|ht|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|inc|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|intuit|investments|io|ipiranga|iq|ir|irish|is|ismaili|ist|istanbul|it|itau|itv|jaguar|java|jcb|je|jeep|jetzt|jewelry|jio|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerryproperties|kfh|kg|kh|ki|kia|kids|kim|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|link|live|living|lk|llc|llp|loan|loans|locker|locus|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|merckmsd|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|moda|moe|moi|mom|monash|money|monster|mormon|mortgage|moscow|moto|motorcycles|mov|movie|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|music|mv|mw|mx|my|mz|na|nab|nagoya|name|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|office|okinawa|olayan|olayangroup|ollo|om|omega|one|ong|onl|online|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|paris|pars|partners|parts|party|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|radio|re|read|realestate|realtor|realty|recipes|red|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|ril|rio|rip|ro|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|sas|save|saxo|sb|sbi|sbs|sc|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|search|seat|secure|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shell|shia|shiksha|shoes|shop|shopping|shouji|show|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|spa|space|sport|spot|sr|srl|ss|st|stada|staples|star|statebank|statefarm|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|viva|vivo|vlaanderen|vn|vodka|volvo|vote|voting|voto|voyage|vu|wales|walmart|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4dbrk0ce|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cckwcxetd|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq480n2rg|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbah1a3hjkrd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgbcpq6gpa1a|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--otu796d|xn--p1acf|xn--p1ai|xn--pgbs0dh|xn--pssy2u|xn--q7ce6a|xn--q9jyb4c|xn--qcka1pmc|xn--qxa6a|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zm|zone|zuerich|zw",RE_IPs="25[0-5]|2[0-4][0-9]|1?[0-9]{1,2}",RE_PORTS=":(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[0-5][0-9]{4}|[1-9][0-9]{0,3})",urlRegex=new RegExp(`(?:https?:\\/\\/)?(?:[-a-z0-9]+\\.){1,}(?:${RE_IPs}|${RE_TLDs})\\b(?:${RE_PORTS}\\b)?(?:/(?:&amp;|[-a-zA-Z0-9@:%_\\+.~#?/=&])*)?`,"g"),mentionRegex=new RegExp(`@([a-zA-Z0-9_\\-]{1,${limits.username}})\\b`,"g"),hashtagRegex=/#([a-zA-Z0-9_]{1,64})\b/g;function withinBounds(e,t,n){for(var o of n)if(o.index<=e&&o.index+o.length-1>=e||o.index<=e+t-1&&o.index+o.length-1>=e+t-1||o.index>=e&&o.index+o.length-1<=e+t-1)return!0;return!1}function urlReplacements(e,t){t.sort((e,t)=>t.index-e.index);for(var n of t){var o=`<a href="${n.href}" ${n.hiddenLink?'class="plain-link"':""} ${n.internalIntent?`data-internal-link="${n.internalIntent}"`:'target="_blank"'}>`;e=e.slice(0,n.index)+o+e.slice(n.index,n.index+n.length)+"</a>"+e.slice(n.index+n.length)}return e}function linkify(t,n){var o,e,a,i=[];for(o of t.matchAll(urlRegex)){let e=o[0];e.startsWith("https://")||e.startsWith("http://")||(e="https://"+e),i.push({index:o.index,length:o[0].length,href:unescapeHTML(e)})}for(e of t.matchAll(mentionRegex))withinBounds(e.index,e[0].length,i)||i.push({index:e.index,length:e[0].length,href:`/u/${e[1]}/`,internalIntent:"user"});for(a of t.matchAll(hashtagRegex))withinBounds(a.index,a[0].length,i)||i.push({index:a.index,length:a[0].length,href:`/tag/${a[1].toLowerCase()}/`,internalIntent:"hashtag"});if(n){var r,s=`/p/${n}/`,l=[];let e=0;i.sort((e,t)=>e.index-t.index);for(r of i)0<r.index-e&&l.push({index:e,length:r.index-e,href:s,internalIntent:"post",hiddenLink:!0}),e=r.index+r.length;n=i[i.length-1];n&&n.index+n.length<t.length?l.push({index:n.index+n.length,length:t.length-n.index-n.length,href:s,internalIntent:"post",hiddenLink:!0}):n||l.push({index:0,length:t.length,href:s,internalIntent:"post",hiddenLink:!0}),i.push(...l)}return urlReplacements(t,i)}let postModalFor=void 0;function createPostModal(t,n){if(!document.getElementById("modal")){let e={hidden_if_no_quote:"hidden",hidden_if_no_comment:"hidden",private_post:"",placeholder:"Cool post",action:"Post"};if(postModalFor=void 0,t&&void 0!==n){var o=postCache[n];if(!o)return void console.log("post modal post not found",n);postModalFor={type:t,id:n},e={placeholder:"Cool post",action:"Post",hidden_if_no_quote:"hidden",hidden_if_no_comment:"hidden",private_post:o.private?"data-private-post":"",username:o.user.username,timestamp:getTimestamp(o.timestamp),content:[simplePostContent(o),1],display_name:[escapeHTML(o.user.display_name),1],content_2:[simplePostContent(o),1],display_name_2:[escapeHTML(o.user.display_name),1]},"quote"===t?(e.hidden_if_no_quote="",e.action="Quote",e.placeholder=["Cool quote","What did they say this time?","Yet another mistake to point out?","Ugh... not again..."][Math.floor(4*Math.random())]):"comment"===t?(e.hidden_if_no_comment="",e.action="Reply",e.placeholder=["Cool comment","Got something to say about this?","Let them know how you feel","Go spread your opinions, little one"][Math.floor(4*Math.random())]):"edit"===t&&(e.placeholder="Cool post but edited",e.action="Save")}console.log(e);var a,o=getSnippet("compose-modal",e);null!=(a=o.querySelector("#modal-post"))&&a.addEventListener("click",postModalCreatePost),null!=(a=o.querySelector("#modal"))&&a.addEventListener("click",clearModalIfClicked),document.body.append(o),null!=(a=o.querySelector("#modal-post-content"))&&a.focus(),document.addEventListener("keydown",clearModalOnEscape),"edit"===t&&void 0!==n&&(a=postCache[n])&&(a.content_warning&&(t=o.querySelector("#modal-post-cw"))&&(t.value=a.content_warning),(n=o.querySelector("#modal-post-content"))&&(n.value=a.content),t=o.querySelector("#modal-post-private"))&&(t.checked=a.private)}}function modifyKeybindModal(o){let e,t,n,a=keybinds[o];var i=getSnippet("keybind-modal",{keybind_title:a.name,keybind_description:a.description||"",hidden_if_no_description:a.description?"":"hidden"});forceDisableKeybinds=!0,null!=(e=i.querySelector("#kb-modal-input"))&&e.addEventListener("keydown",e=>{if(!["shift","alt","control","meta"," "].includes(e.key.toLowerCase()))if(setKeybindKey(o,e.key,{alt:e.altKey,ctrl:e.ctrlKey,nav:a.modifiers&&a.modifiers.includes("nav"),shift:e.shiftKey})){if("navModifier"===o)for(var t of document.querySelectorAll('[data-kb-id^="nav"]'))setKeybindElementData(t.dataset.kbId||o,t);var n=document.querySelector(`[data-kb-id="${o}"]`);n&&setKeybindElementData(o,n),clearModal()}else createToast("Key already in use");e.preventDefault()}),document.body.append(i),null!=(t=i.querySelector("#kb-modal-input"))&&t.focus(),null!=(n=i.querySelector("#modal"))&&n.addEventListener("click",clearModalIfClicked),document.addEventListener("keydown",clearModalOnEscape)}function postModalCreatePost(s){var e=document.getElementById("modal-post-cw");let l=document.getElementById("modal-post-content");var t=document.getElementById("modal-post-private");if(e&&l&&t){let a=e.value,i=l.value,r=t.checked;i?(null!=(e=s.target)&&e.setAttribute("disabled",""),postModalFor&&"edit"===postModalFor.type?fetch("/api/post",{method:"PATCH",body:buildRequest([[postModalFor.id,32],r,[i,16],[a,8]])}).then(e=>e.arrayBuffer()).then(e=>{var t;if(!(new Uint8Array(e)[0]>>7&1)&&postModalFor){var n=postCache[postModalFor.id];if(clearModal(),n){n.content=i,n.content_warning=a,n.private=r;for(var o of document.querySelectorAll(`[data-edit-replace="${postModalFor.id}"]`))o.replaceWith(getPost(n.id,!1))}}else l.focus(),null!=(t=s.target)&&t.removeAttribute("disabled");return e}).then(parseResponse).catch(e=>{var t;throw l.focus(),null!=(t=s.target)&&t.removeAttribute("disabled"),e}):createPost(i,a||null,r,e=>{var t,n;if(e){if(postModalFor&&"quote"===postModalFor.type)for(t of document.querySelectorAll(`[data-interaction-quote="${postModalFor.id}"] [data-number]`))isNaN(+t.innerText)||(t.innerText=String(+t.innerText+1));else if(postModalFor&&"comment"===postModalFor.type)for(n of document.querySelectorAll(`[data-interaction-comment="${postModalFor.id}"] [data-number]`))isNaN(+n.innerText)||(n.innerText=String(+n.innerText+1));clearModal()}else l.focus(),null!=(e=s.target)&&e.removeAttribute("disabled")},postModalFor&&{[postModalFor.type]:postModalFor.id})):l.focus()}}function clearModalOnEscape(e){"Escape"===e.key&&(clearModal(),document.removeEventListener("keydown",clearModalOnEscape),e.preventDefault())}function clearModalIfClicked(e){void 0!==(null==(e=e.target)?void 0:e.dataset.closeModal)&&clearModal()}function clearModal(){var e;null!=(e=document.getElementById("modal"))&&e.remove(),forceDisableKeybinds=!1}let container=document.getElementById("container");function urlToIntent(e){if(e=normalizePath(e),loggedIn)switch(e){case"/home/":case"/login/":case"/signup/":history.pushState("home","","/");case"/":return"home";case"/notifications/":return"notifications";case"/follow-requests/":return"follow-requests";case"/settings/":return"settings";case"/settings/profile/":return"settings/profile";case"/settings/cosmetic/":return"settings/cosmetic";case"/settings/keybinds/":return"settings/keybinds";case"/settings/account/":return"settings/account";case"/settings/about/":return"settings/about";case/^\/u\/[a-z0-9_\-]+\/$/.test(e)?e:"":return"user";case/^\/p\/[0-9]+\/$/.test(e)?e:"":return"post";case/^\/tag\/[a-z0-9_]+\/$/.test(e)?e:"":return"hashtag"}else switch(e){case"/":return"index";case"/login/":return"login";case"/signup/":return"signup"}return"/logout/"!==e?"404":"logout"}function generateInternalLinks(e){var t;for(t of(e=e||container).querySelectorAll("[data-internal-link]:not([data-link-processed])"))t.dataset.linkProcessed="",t.addEventListener("click",internalLinkHandler)}function internalLinkHandler(t){if(!t.ctrlKey){var n=t.currentTarget,o=n.dataset.internalLink;let e=n.href||null;(e=null!=e&&e.includes("//")?"/"+e.split("//")[1].split("/").slice(1).join("/"):e)&&"post"===o&&getPostIDFromPath(e)===getPostIDFromPath()?createPostModal("comment",getPostIDFromPath()):(o!==currentPage||"post"===o||e&&"user"===o&&getUsernameFromPath(e)!==getUsernameFromPath()||e&&"hashtag"===o&&getHashtagFromPath(e)!==getHashtagFromPath())&&(history.pushState(o,"",e),renderPage(o),currentPage=o),t.preventDefault()}}function normalizePath(e){return e.endsWith("/")||(e+="/"),(e=e.startsWith("/")?e:"/"+e).toLowerCase()}function renderPage(e){let t={},n;switch(e){case"user":var o=getUsernameFromPath();n=userCache[o],t={color_one:n&&n.color_one||"var(--background-mid)",color_two:n&&n.color_two||"var(--background-mid)",following:n&&floatintToStr(n.num_following)||"0",followers:n&&floatintToStr(n.num_followers)||"0",bio:n?[linkify(escapeHTML(n.bio)),1]:"",user_username:n?[escapeHTML(o+(n.pronouns&&" - ")+n.pronouns),1]:o,display_name:n?[escapeHTML(n.display_name),1]:o};break;case"settings/profile":o=window.getComputedStyle(document.documentElement).getPropertyValue("--background-mid");n=userCache[username],t={color_one:n&&n.color_one||o,color_two:n&&n.color_two||o,checked_if_gradient:n&&n.color_one&&n.color_two&&n.color_one!==n.color_two?"checked":"",display_name:n&&escapeHTML(n.display_name)||username,bio:n&&escapeHTML(n.bio)||""};break;case"post":var o=getPostIDFromPath(),a=postCache[o];t={pid:String(o),parent:String(a&&a.comment),hidden_if_comment:a&&a.comment?"hidden":"",hidden_if_not_comment:a&&a.comment?"":"hidden"};break;case"hashtag":t={tag:getHashtagFromPath()}}tlPollingIntervalID&&(clearInterval(tlPollingIntervalID),tlPollingIntervalID=null);var i=getSnippet("pages/"+e,t);container.replaceChildren(i),document.title=getPageTitle(e),currentPage=e,resetNotificationIndicators()}function getPageTitle(e){let t="",n=(Object.values(pendingNotifications).some(Boolean)&&(t="â€¢ "),e);switch(e){case"login":n="Log In - ";break;case"signup":n="Sign Up - ";break;case"logout":n="Log Out - ";break;case"404":n="Page Not Found - ";break;case"user":n=getUsernameFromPath()+" - ";break;case"notifications":n="Notifications - ";break;case"follow-requests":n="Follow Requests - ";break;case"index":case"home":case"post":n=null;break;case"settings":case"settings/profile":case"settings/cosmetic":case"settings/keybinds":case"settings/account":case"settings/about":n="Settings - "}return n?t+n+pageTitle:t+pageTitle}let pendingNotifications={notifications:!(onpopstate=function(e){renderPage(currentPage=e.state)}),messages:!1,follow_requests:!1};function fetchNotifications(){fetch("/api/notifications").then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{console.log("timeline polling error",e)})}function resetNotificationIndicators(){var e=document.querySelector('#navbar a[data-internal-link="notifications"]'),t=document.querySelector('#navbar a[data-internal-link="messages"]'),n=document.querySelector('#navbar a[data-internal-link="follow-requests"]');e&&(pendingNotifications.notifications?e.dataset.notification="":delete e.dataset.notification),t&&(pendingNotifications.messages?t.dataset.notification="":delete t.dataset.notification),n&&(pendingNotifications.follow_requests?(n.dataset.notification="",n.removeAttribute("hidden")):delete n.dataset.notification),document.title=getPageTitle(currentPage)}var ResponseCodes,ErrorCodes,_a,_b,_c,NotificationCodes;function floatintToStr(e){if(e>>14&1)return"Infinity";let t=1,n=(e>>3&1023)*(t=e>>13&1?-1:t);var o=3&e;Boolean(e>>2&1)&&(n/=10);let a="";switch(o){case 0:a="";break;case 1:a="k";break;case 2:a="m";break;case 3:a="b"}return String(n)+a}function floatintToNum(e){if(e>>14&1)return 1/0;let t=1,n=(e>>3&1023)*(t=e>>13&1?-1:t);var o=3&e;return Boolean(e>>2&1)&&(n/=10),n*Math.pow(1e3,o)}function _getErrorStrings(e,t){switch(e){case ErrorCodes.BadRequest:return["Something went wrong!"];case ErrorCodes.BadUsername:switch(t){case ResponseCodes.LogIn:return["Invalid username.","No user has that username."];case ResponseCodes.SignUp:return["Invalid username.","Usernames can only include the characters a-z, 0-9, _, and -."];case ResponseCodes.TimelineUser:return userSetDNE(),[null];default:return["Invalid username."]}case ErrorCodes.UsernameUsed:return["Username in use."];case ErrorCodes.BadPassword:return["Invalid password."];case ErrorCodes.InvalidOTP:return["Invalid invite code.","Make sure your invite code is correct and try again."];case ErrorCodes.CantInteract:return t!==ResponseCodes.DeletePost?["Can't interact.","You can't interact with this user for some reason."]:["Can't delete.","You don't have permissions to delete this post."];case ErrorCodes.Blocking:return["You are blocking this person.","You need to unblock them to do this."];case ErrorCodes.PostNotFound:return t!==ResponseCodes.TimelineComments?["Post not found."]:(postSetDNE(),[null]);case ErrorCodes.PollSingleOption:return["Invalid poll.","Must have more than one option."];case ErrorCodes.NotAuthenticated:return["Not Authenticated.","You need to be logged in to do this."];case ErrorCodes.Ratelimit:return["Ratelimited.","Try again in a few seconds."]}return["Something went wrong!","Error code "+t.toString(16)+e.toString(16)]}function _extractString(e,t){var n=_extractInt(e,t);return[(new TextDecoder).decode(t.slice(e/8,e/8+n)),t.slice(e/8+n)]}function _extractInt(t,n){let o=0;for(let e=0;8*e<t;e++)o=(o<<=8)+n[e];return o}function _extractBool(e,t){return Boolean(e>>t&1)}function _extractPost(e){var t=_extractInt(32,e);let n=null;var o=_extractInt(64,e.slice(4)),a=e[12];let i=e.slice(13);_extractBool(a,6)&&(n=_extractInt(32,i),i=i.slice(4));var e={likes:_extractInt(16,i),liked:_extractBool(a,3),quotes:_extractInt(16,i.slice(2)),comments:_extractInt(16,i.slice(4))},r=_extractString(16,i.slice(6)),s=_extractString(8,r[1]),l=_extractString(8,s[1]),c=_extractString(8,l[1]),d=_extractString(8,c[1]);let u=null;if(i=d[1],_extractBool(a,5))if(_extractBool(a,4)){var m=_extractBool(a,1);let e=null;m&&(e=_extractInt(32,i.slice(12)));var m=_extractString(16,i.slice(12+4*+m)),p=_extractString(8,m[1]),g=_extractString(8,p[1]),h=_extractString(8,g[1]),f=_extractString(8,h[1]);u={id:_extractInt(32,i),content:m[0],content_warning:p[0],timestamp:_extractInt(64,i.slice(4)),private:_extractBool(a,2),comment:e,user:{username:g[0],display_name:h[0],pronouns:f[0]}},i=f[1]}else u=void 0;return[{id:t,content:r[0],content_warning:s[0],timestamp:o,private:_extractBool(a,7),comment:n,interactions:e,user:{username:l[0],display_name:c[0],pronouns:d[0]},quote:u},i]}function _toHex(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}function parseResponse(e,n){let o,a=new Uint8Array(e),i,r,s,l,c,d,u;if(a[0]>>7&1)return createToast(..._getErrorStrings(a[1],128^a[0]));switch(a[0]){case ResponseCodes.LogIn:case ResponseCodes.SignUp:setTokenCookie(_toHex(a.slice(1))),location.href="/";break;case ResponseCodes.Follow:updateFollowButton(!0,Boolean(128&a[1]));break;case ResponseCodes.Unfollow:updateFollowButton(!1);break;case ResponseCodes.Block:updateBlockButton(!0);break;case ResponseCodes.Unblock:updateBlockButton(!1);break;case ResponseCodes.AcceptFolreq:case ResponseCodes.DenyFolreq:break;case ResponseCodes.GetProfile:i=_extractString(8,a.slice(1)),r=_extractString(16,i[1]),u=_extractString(8,r[1]),profileSettingsSetUserData(i[0],r[0],u[0],"#"+_toHex(u[1].slice(0,3)),"#"+_toHex(u[1].slice(3,6)),_extractBool(u[1][6],7),_extractBool(u[1][6],6));break;case ResponseCodes.SaveProfile:createToast("Success!","Your profile has been saved."),updateUserCacheFromCosmeticSettings();break;case ResponseCodes.DeleteAccount:renderPage("logout");break;case ResponseCodes.ChangePassword:changePasswordSuccess(_toHex(a.slice(1)));break;case ResponseCodes.DefaultVisibility:case ResponseCodes.VerifyFollowers:break;case ResponseCodes.CreatePost:prependPostToTimeline(_extractPost(a.slice(1))[0]);break;case ResponseCodes.Like:case ResponseCodes.Unlike:break;case ResponseCodes.Pin:createToast("Success!","Pinned to your profile.");break;case ResponseCodes.Unpin:createToast("Success!","This post is no longer pinned to your profile."),null!=(o=document.getElementById("user-pinned-container"))&&o.setAttribute("hidden","");break;case ResponseCodes.EditPost:break;case ResponseCodes.DeletePost:handlePostDelete(_extractInt(32,a.slice(1)));break;case ResponseCodes.TimelineUser:i=_extractString(8,a.slice(1)),u=_extractString(8,i[1]);var m=(r=_extractString(16,u[1]))[1][10];let e=null,t;_extractBool(m,2)&&(t=_extractPost(r[1].slice(11)),e=insertIntoPostCache([t[0]])[0]),userUpdateStats(i[0],u[0],r[0],"#"+_toHex(r[1].slice(0,3)),"#"+_toHex(r[1].slice(3,6)),_extractBool(r[1][10],3)?"pending":_extractBool(r[1][10],5),_extractBool(r[1][10],4),_extractInt(16,r[1].slice(8)),_extractInt(16,r[1].slice(6)),e),a=new Uint8Array([0,m].concat(Array.from(t?t[1]:r[1].slice(11))));case ResponseCodes.TimelineComments:a[0]===ResponseCodes.TimelineComments&&(updateFocusedPost((m=_extractPost(a.slice(1)))[0]),a=m[1]);case ResponseCodes.TimelineGlobal:case ResponseCodes.TimelineFollowing:case ResponseCodes.TimelineHashtag:s=_extractBool(a[1],7),l=_extractBool(a[1],6),c=a[2],d=[],a=a.slice(3);for(let e=0;e<c;e++){var p=_extractPost(a);d.push(p[0]),a=p[1]}l?null!=n&&n.startsWith("$")?handleForward(d,s,n.slice(1),!0):n?handleForward(d,s,n):console.log("uh uhhhh why isn't the url set for forwards tl ????"):renderTimeline(insertIntoPostCache(d),s);break;case ResponseCodes.TimelineNotifications:s=_extractBool(a[1],7),l=_extractBool(a[1],6),c=a[2],d=[],a=a.slice(3);for(let e=0;e<c;e++){var g=_extractPost(a.slice(1));d.push([g[0],a[0]]),a=g[1]}l?null!=n&&n.startsWith("$")?handleNotificationForward(d,s,n.slice(1),!0):n?handleNotificationForward(d,s,n):console.log("uh uhhhh why isn't the url set for forwards tl ????"):renderNotificationTimeline(d,s,!1);break;case ResponseCodes.TimelineFolreq:s=_extractBool(a[1],7);var h=a[2],f=[];a=a.slice(3);for(let e=0;e<h;e++){var v=_extractInt(32,a),b=_extractString(8,a.slice(4)),y=_extractString(8,b[1]),w=_extractString(16,y[1]);a=w[1],f.push({username:b[0],display_name:y[0],bio:w[0],id:v})}renderFolreqTimeline(f,s,!1);break;case ResponseCodes.Notifications:pendingNotifications={notifications:_extractBool(a[1],7),messages:_extractBool(a[1],6),follow_requests:_extractBool(a[1],5)},resetNotificationIndicators();break;default:console.log("Unknown response code "+a[0].toString(16))}}loggedIn&&(fetchNotifications(),setInterval(fetchNotifications,6e4)),(e=>{e[e.LogIn=1]="LogIn",e[e.SignUp=2]="SignUp",e[e.Follow=16]="Follow",e[e.Unfollow=17]="Unfollow",e[e.Block=18]="Block",e[e.Unblock=19]="Unblock",e[e.AcceptFolreq=20]="AcceptFolreq",e[e.DenyFolreq=21]="DenyFolreq",e[e.GetProfile=32]="GetProfile",e[e.SaveProfile=33]="SaveProfile",e[e.DeleteAccount=34]="DeleteAccount",e[e.ChangePassword=35]="ChangePassword",e[e.DefaultVisibility=36]="DefaultVisibility",e[e.VerifyFollowers=37]="VerifyFollowers",e[e.CreatePost=48]="CreatePost",e[e.Like=49]="Like",e[e.Unlike=50]="Unlike",e[e.Pin=51]="Pin",e[e.Unpin=52]="Unpin",e[e.EditPost=62]="EditPost",e[e.DeletePost=63]="DeletePost",e[e.TimelineGlobal=96]="TimelineGlobal",e[e.TimelineFollowing=97]="TimelineFollowing",e[e.TimelineUser=98]="TimelineUser",e[e.TimelineComments=99]="TimelineComments",e[e.TimelineNotifications=100]="TimelineNotifications",e[e.TimelineHashtag=101]="TimelineHashtag",e[e.TimelineFolreq=102]="TimelineFolreq",e[e.Notifications=112]="Notifications"})(ResponseCodes=ResponseCodes||{}),(e=>{e[e.BadRequest=0]="BadRequest",e[e.BadUsername=16]="BadUsername",e[e.UsernameUsed=17]="UsernameUsed",e[e.BadPassword=18]="BadPassword",e[e.InvalidOTP=19]="InvalidOTP",e[e.CantInteract=32]="CantInteract",e[e.Blocking=33]="Blocking",e[e.PostNotFound=48]="PostNotFound",e[e.PollSingleOption=49]="PollSingleOption",e[e.NotAuthenticated=254]="NotAuthenticated",e[e.Ratelimit=255]="Ratelimit"})(ErrorCodes=ErrorCodes||{});let icons={back:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9.8s8.8 24.8-.8 33.9L83.9 232H424c13.3 0 24 10.7 24 24s-10.7 24-24 24H83.9l132.7 126.6c9.6 9.2 9.9 24.3.8 33.9s-24.3 9.9-33.9.8l-176-168z"/></svg>',private:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M130.9 168.3v54.4h136v-54.4c0-37.57-30.43-68-68-68s-68 30.43-68 68m-40.8 54.4v-54.4c0-60.095 48.705-108.8 108.8-108.8s108.8 48.705 108.8 108.8v54.4h27.2c30.005 0 54.4 24.395 54.4 54.4v163.2c0 30.005-24.395 54.4-54.4 54.4h-272c-30.005 0-54.4-24.395-54.4-54.4V277.1c0-30.005 24.395-54.4 54.4-54.4zm-40.8 54.4v163.2c0 7.48 6.12 13.6 13.6 13.6h272c7.48 0 13.6-6.12 13.6-13.6V277.1c0-7.48-6.12-13.6-13.6-13.6h-272c-7.48 0-13.6 6.12-13.6 13.6"/></svg>',comment_arrow:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M488 528c13.3 0 24 10.7 24 24s-10.7 24-24 24h-96c-53 0-96-43-96-96V145.9l-95 95c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9L303 71c4.5-4.5 10.6-7 17-7s12.5 2.5 17 7l136 136c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-95-95V480c0 26.5 21.5 48 48 48h96z"/></svg>',comment:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4 26.5 9.6 56.2 15.1 87.8 15.1 124.7 0 208-80.5 208-160S380.7 80 256 80 48 160.5 48 240c0 32 12.4 62.8 35.7 89.2 8.6 9.7 12.8 22.5 11.8 35.5-1.4 18.1-5.7 34.7-11.3 49.4 17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9q2.7-4.05 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240 0 125.1 114.6 32 256 32s256 93.1 256 208-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9-11.9 8.7-31.3 20.6-54.3 30.6-15.1 6.6-32.3 12.6-50.1 16.1-.8.2-1.6.3-2.4.5-4.4.8-8.7 1.5-13.2 1.9-.2 0-.5.1-.7.1-5.1.5-10.2.8-15.3.8-6.5 0-12.3-3.9-14.8-9.9S0 457.4 4.5 452.8c4.1-4.2 7.8-8.7 11.3-13.5q2.55-3.45 4.8-6.9c.1-.2.2-.3.3-.5z"/></svg>',quote:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 254.5c-.8 13.2 9.2 24.6 22.5 25.5s24.6-9.2 25.5-22.5l.5-8c3.4-54.8 48.8-97.5 103.7-97.5H366l-55 55c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l96-96c9.4-9.4 9.4-24.6 0-33.9L345 15c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l55 55H152.3C72 104 5.6 166.4.5 246.5zm511.9 3c.8-13.2-9.2-24.6-22.5-25.5s-24.6 9.2-25.4 22.5l-.5 8c-3.4 54.8-48.9 97.5-103.8 97.5H145.9l55-55c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0L71 367c-9.4 9.4-9.4 24.6 0 33.9l96 96c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-55-55h213.8c80.3 0 146.7-62.4 151.7-142.5z"/></svg>',like:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="m225.8 468.2-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144 39.4-7.6 79.7 1.5 111.8 24.1 9 6.4 17.4 13.8 25 22.3 4.2-4.8 8.7-9.2 13.5-13.3 3.7-3.2 7.5-6.2 11.5-9 32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9M239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20-.1-.1c-23.1-25.9-58-37.7-92-31.2-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9-34-6.5-69 5.4-92 31.2l-.1.1-.1.1-17.8 20c-.3.4-.7.7-1 1.1-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>',like_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="m47.6 300.4 180.7 168.7c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9l180.7-168.7c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141-45.6-7.6-92 7.3-124.6 39.9l-12 12-12-12c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5"/></svg>',hamburger:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32m0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32m448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32 14.3 32 32"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M395.8 39.6c9.4-9.4 24.6-9.4 33.9 0l42.6 42.6c9.4 9.4 9.4 24.6 0 33.9L417.6 171 341 94.4zM318.4 117l76.6 76.6-219 219V400c0-8.8-7.2-16-16-16h-32v-32c0-8.8-7.2-16-16-16H99.4zM66.9 379.5c1.2-4 2.7-7.9 4.7-11.5H96v32c0 8.8 7.2 16 16 16h32v24.4c-3.7 1.9-7.5 3.5-11.6 4.7l-92.8 27.3 27.3-92.8zM452.4 17c-21.9-21.9-57.3-21.9-79.2 0L60.4 329.7c-11.4 11.4-19.7 25.4-24.2 40.8L.7 491.5c-1.7 5.6-.1 11.7 4 15.8s10.2 5.7 15.8 4l121-35.6c15.4-4.5 29.4-12.9 40.8-24.2L495 138.8c21.9-21.9 21.9-57.3 0-79.2zM331.3 202.7c6.2-6.2 6.2-16.4 0-22.6s-16.4-6.2-22.6 0l-128 128c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0z"/></svg>',pin:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="m134.6 51.7-10.8 140.9c-1.1 14.6-8.8 27.8-20.9 36-23.9 16.2-41.8 40.8-49.1 70.3l-1.3 5.1h279l-1.3-5.1c-7.4-29.5-25.2-54.1-49.1-70.2-12.1-8.2-19.8-21.5-20.9-36l-10.8-141c-.1-1.2-.1-2.5-.1-3.7H134.8c0 1.2 0 2.5-.2 3.7M168 352H32c-9.9 0-19.2-4.5-25.2-12.3s-8.2-17.9-5.8-27.5l6.2-25c10.3-41.3 35.4-75.7 68.7-98.3L83.1 96l3.7-48H56c-4.4 0-8.6-1.2-12.2-3.3C36.8 40.5 32 32.8 32 24 32 10.7 42.7 0 56 0h272c13.3 0 24 10.7 24 24 0 8.8-4.8 16.5-11.8 20.7-3.6 2.1-7.7 3.3-12.2 3.3h-30.8l3.7 48 7.1 92.9c33.3 22.6 58.4 57.1 68.7 98.3l6.2 25c2.4 9.6.2 19.7-5.8 27.5S361.7 352 351.9 352H216v136c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>',unpin:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M73 39.1c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6-.1 34l528 528c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9L449.8 416h23.9c21.2 0 38.3-17.2 38.3-38.3 0-29.2-12.5-57-28.5-79.5-13.4-18.9-30.2-35.5-47.5-48L425.8 112h-48.2l10.5 141.8 1.7 22.3 18.2 13.1c16.1 11.6 29.3 26.3 40.4 42.8 6.9 10.8 13 23.3 14.7 36.1h-61.3L254.2 220.5l8-108.4h-48.1l-4.7 63.6L72.9 39.2zM213.8 112H456c13.3 0 24-10.7 24-24s-10.7-24-24-24H184c-5.1 0-9.9 1.6-13.8 4.4zm100.4 304-48-48h-89.3c2.5-15.3 9.9-29.5 18.8-42.1 3.9-5.4 8.2-10.7 12.8-15.7l-34-34c-6.4 6.9-12.5 14.2-18 21.9-15.9 22.5-28.5 50.3-28.5 79.5 0 21.2 17.2 38.3 38.3 38.3h147.8zM296 584c0 13.3 10.7 24 24 24s24-10.7 24-24V464h-48z"/></svg>',delete:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="m170.5 51.6-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6 36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"/></svg>',home_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1H392c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.6H32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24"/></svg>',home:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M303.5 5.7c-9-7.6-22.1-7.6-31.1 0l-264 224c-10.1 8.6-11.3 23.7-2.8 33.8s23.7 11.3 33.8 2.8L64 245.5V432c0 44.2 35.8 80 80 80h288c44.2 0 80-35.8 80-80V245.5l24.5 20.8c10.1 8.6 25.3 7.3 33.8-2.8s7.3-25.3-2.8-33.8zM112 432V204.8L288 55.5l176 149.3V432c0 17.7-14.3 32-32 32h-48V312c0-22.1-17.9-40-40-40H232c-22.1 0-40 17.9-40 40v152h-48c-17.7 0-32-14.3-32-32m128 32V320h96v144z"/></svg>',notifications_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416h384c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3c-31.2-35.2-48.5-80.5-48.5-127.6V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m45.3 493.3c12-12 18.7-28.3 18.7-45.3H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7"/></svg>',notifications:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v25.4c0 45.4-15.5 89.5-43.8 124.9L5.3 377c-5.8 7.2-6.9 17.1-2.9 25.4S14.8 416 24 416h400c9.2 0 17.6-5.3 21.6-13.6s2.9-18.2-2.9-25.4l-14.9-18.6c-28.3-35.5-43.8-79.6-43.8-125V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m0 96c61.9 0 112 50.1 112 112v25.4c0 47.9 13.9 94.6 39.7 134.6H72.3c25.8-40 39.7-86.7 39.7-134.6V208c0-61.9 50.1-112 112-112m64 352H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7S288 465 288 448"/></svg>',messages_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>',messages:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>',user_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 256a128 128 0 1 0 0-256 128 128 0 1 0 0 256m-45.7 48C79.8 304 0 383.8 0 482.3 0 498.7 13.3 512 29.7 512h388.6c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3z"/></svg>',user:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M304 128a80 80 0 1 0-160 0 80 80 0 1 0 160 0m-208 0a128 128 0 1 1 256 0 128 128 0 1 1-256 0M49.3 464h349.5c-8.9-63.3-63.3-112-129-112h-91.4c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3"/></svg>',settings_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M495.9 166.6c3.2 8.7.5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4l-55.6 17.8c-8.8 2.8-18.6.3-24.5-6.8-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4c-1.1-8.4-1.7-16.9-1.7-25.5s.6-17.1 1.7-25.4l-43.3-39.4c-6.9-6.2-9.6-15.9-6.4-24.6 4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2 5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8 8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 0c17 0 33.6 1.7 49.8 4.8 7.9 1.5 21.8 6.1 29.4 20.1 2 3.7 3.6 7.6 4.6 11.8l9.3 38.5c1.4 5.8 11.2 11.5 16.9 9.8l38-11.2c4-1.2 8.1-1.8 12.2-1.9 16.1-.5 27 9.4 32.3 15.4 22.1 25.1 39.1 54.6 49.9 86.3 2.6 7.6 5.6 21.8-2.7 35.4-2.2 3.6-4.9 7-8 10L459 246.3c-4.2 4-4.2 15.5 0 19.5l28.7 27.3c3.1 3 5.8 6.4 8 10 8.2 13.6 5.2 27.8 2.7 35.4-10.8 31.7-27.8 61.1-49.9 86.3-5.3 6-16.3 15.9-32.3 15.4-4.1-.1-8.2-.8-12.2-1.9L366 427c-5.7-1.7-15.5 4-16.9 9.8l-9.3 38.5c-1 4.2-2.6 8.2-4.6 11.8-7.7 14-21.6 18.5-29.4 20.1-16.2 3.1-32.8 4.8-49.8 4.8s-33.6-1.7-49.8-4.8c-7.9-1.5-21.8-6.1-29.4-20.1-2-3.7-3.6-7.6-4.6-11.8l-9.3-38.5c-1.4-5.8-11.2-11.5-16.9-9.8l-38 11.2c-4 1.2-8.1 1.8-12.2 1.9-16.1.5-27-9.4-32.3-15.4-22-25.1-39.1-54.6-49.9-86.3-2.6-7.6-5.6-21.8 2.7-35.4 2.2-3.6 4.9-7 8-10L53 265.7c4.2-4 4.2-15.5 0-19.5l-28.8-27.3c-3.1-3-5.8-6.4-8-10-8.2-13.6-5.2-27.8-2.6-35.3 10.8-31.7 27.8-61.1 49.9-86.3 5.3-6 16.3-15.9 32.3-15.4 4.1.1 8.2.8 12.2 1.9L146 85c5.7 1.7 15.5-4 16.9-9.8l9.3-38.5c1-4.2 2.6-8.2 4.6-11.8 7.7-14 21.6-18.5 29.4-20.1C222.4 1.7 239 0 256 0m-37.9 51.4-8.5 35.1c-7.8 32.3-45.3 53.9-77.2 44.6l-34.5-10.2c-16.5 19.3-29.5 41.7-38 65.7l26.2 24.9c24 22.8 24 66.2 0 89l-26.2 24.9c8.5 24 21.5 46.4 38 65.7l34.6-10.2c31.8-9.4 69.4 12.3 77.2 44.6l8.5 35.1c24.6 4.5 51.3 4.5 75.9 0l8.5-35.1c7.8-32.3 45.3-53.9 77.2-44.6l34.6 10.2c16.5-19.3 29.5-41.7 38-65.7l-26.2-24.9c-24-22.8-24-66.2 0-89l26.2-24.9c-8.5-24-21.5-46.4-38-65.7l-34.6 10.2c-31.8 9.4-69.4-12.3-77.2-44.6l-8.5-35.1c-24.6-4.5-51.3-4.5-75.9 0zM208 256a48 48 0 1 0 96 0 48 48 0 1 0-96 0m48 96a96 96 0 1 1 0-192 96 96 0 1 1 0 192"/></svg>',folreq:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M224 48a80 80 0 1 1 0 160 80 80 0 1 1 0-160m0 208a128 128 0 1 0 0-256 128 128 0 1 0 0 256m-45.7 96h91.4c65.7 0 120.1 48.7 129 112H49.3c8.9-63.3 63.3-112 129-112m0-48C79.8 304 0 383.8 0 482.3 0 498.7 13.3 512 29.7 512h388.6c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3zm325.7 8c0 13.3 10.7 24 24 24s24-10.7 24-24v-64h64c13.3 0 24-10.7 24-24s-10.7-24-24-24h-64v-64c0-13.3-10.7-24-24-24s-24 10.7-24 24v64h-64c-13.3 0-24 10.7-24 24s10.7 24 24 24h64z"/></svg>',folreq_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M96 128a128 128 0 1 1 256 0 128 128 0 1 1-256 0M0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3M504 312v-64h-64c-13.3 0-24-10.7-24-24s10.7-24 24-24h64v-64c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24h-64v64c0 13.3-10.7 24-24 24s-24-10.7-24-24"/></svg>'},snippetVariables={site_name:pageTitle,home_page:loggedIn?"home":"index",username:loggedIn?username:"",selected_if_default_private:defaultPostPrivate?"selected":"",checked_if_default_private:defaultPostPrivate?"checked":""},snippetProcessing={input_enter:p_inputEnter,password_toggle:p_passwordToggle,timeline_switch:p_tlSwitch,timeline_more:p_tlMore,login:p_login,signup:p_signup,logout:p_logout,home:p_home,user:p_user,post:p_post,post_page:p_postPage,notifications:p_notifications,hashtag:p_hashtag,follow_requests:p_folreq,settings_profile:p_settingsProfile,settings_cosmetic:p_settingsCosmetic,settings_account:p_settingsAccount,settings_keybinds:p_settingsKeybinds},snippets={};function getSnippet(e,t){var n,o,e=snippets[e];let a=e.content;for(n of Object.keys(icons))a=a.replaceAll(`@{icon_${n}}`,icons[n]);for(o of e.variables){let t="",n=0;if("string"==typeof o?o in snippetVariables?t=snippetVariables[o]:console.log(`Unknown snippet variable "${o}"`):(n=o[1],o[0]in snippetVariables?t=o[0]:console.log(`Unknown snippet variable "${o}"`)),n)for(let e=0;e<n;e++)a=a.replace(`@{${"string"==typeof o?o:o[0]}}`,t);else a=a.replaceAll(`@{${"string"==typeof o?o:o[0]}}`,t)}if(t)for(var i of Object.keys(t))if("string"==typeof t[i])a=a.replaceAll(`@{${i}}`,t[i]);else for(let e=0;e<t[i][1];e++)a=a.replace(`@{${i}}`,t[i][0]);var r,s=document.createElement("div");s.innerHTML=a;for(r of e.processing)r in snippetProcessing?snippetProcessing[r](s):console.log(`Unknown snippet process "${r}"`);return generateInternalLinks(s),s}function p_inputEnter(e){for(var t of e.querySelectorAll("[data-enter-submit]"))t.onkeydown=inputEnterEvent}function p_passwordToggle(e){for(var t of e.querySelectorAll("[data-password-toggle]"))t.onclick=togglePasswords}for(let e of document.querySelectorAll("[data-snippet]"))snippets[e.dataset.snippet]={variables:(null==(_a=e.dataset.snippetVariables)?void 0:_a.split(",").filter(e=>e).map(e=>e.includes(":")?[e.split(":")[0],+e.split(":")[1]]:e))||[],processing:(null==(_b=e.dataset.snippetProcessing)?void 0:_b.split(",").filter(e=>e))||[],content:e.innerHTML},e.remove();null!=(_c=document.getElementById("snippets"))&&_c.remove();let themeMedia=matchMedia("(prefers-color-scheme: light)"),_themeLs=localStorage.getItem("smiggins-theme"),theme="light"===_themeLs||"dark"===_themeLs?_themeLs:"system";function setTheme(e){switch(e){case"system":localStorage.removeItem("smiggins-theme"),theme="system",updateTheme(themeMedia.matches);break;case"light":localStorage.setItem("smiggins-theme","light"),theme="light",updateTheme(!0);break;case"dark":localStorage.setItem("smiggins-theme","dark"),updateTheme(!(theme="dark"))}}function updateTheme(e){e?document.documentElement.dataset.light="":delete document.documentElement.dataset.light}function updateAutoTheme(){"system"===theme&&updateTheme(themeMedia.matches)}themeMedia.addEventListener("change",updateAutoTheme),updateTheme("light"===theme||"system"===theme&&themeMedia.matches);let currentTl,currentTlID,tlElement,timelines={},tlPollingIntervalID=null,tlPollingPendingResponse=!1,prependedPosts=0,timelineToggles=[],tlCache={},postCache={},userCache={},offset={upper:null,lower:null},LOADING_HTML='<i class="timeline-status">Loading...</i>',TL_POLLING_INTERVAL=1e4;function hookTimeline(e,t,n,o){timelineToggles=[],timelines=t,tlElement=e,_setTimeline(n,o)}function reloadTimeline(e=!1,t){tlElement.innerHTML=LOADING_HTML,prependedPosts=0;var n=tlCache[currentTlID];if(currentTl.disableCaching||e||!n||!1===n.pendingForward)null!=(e=document.getElementById("timeline-more"))&&e.setAttribute("hidden",""),delete tlCache[currentTlID],offset.upper=null,offset.lower=null,fetch(currentTl.url).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e});else{offset={upper:n.upperBound,lower:n.lowerBound},n.posts=n.pendingForward.reverse().concat(n.posts);var o,a=[];for(o of n.posts){var i=postCache[o],i=i&&userCache[i.user.username];!currentTl.url.startsWith("user_")&&i&&i.blocking||a.push(o)}(currentTl.customRender||renderTimeline)(a,n.end,!1,null==t?void 0:t.querySelector("#timeline-more")),timelinePolling(!0)}}function insertIntoPostCache(e){var t,n=[];for(t of e)postCache[t.id]=t,n.push(t.id);return n}function loadMorePosts(){let t=document.getElementById("timeline-more");t&&(t.hidden=!0),tlElement.insertAdjacentHTML("beforeend",LOADING_HTML),fetch(`${currentTl.url}${currentTl.url.includes("?")?"&":"?"}offset=`+offset.lower).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),t&&(t.hidden=!1),clearTimelineStatuses(),e})}function clearTimelineStatuses(){var e;for(e of tlElement.querySelectorAll(".timeline-status"))e.remove()}function renderTimeline(t,n,e=!0,o){if(clearTimelineStatuses(),null===offset.lower&&0===t.length)(r=document.createElement("i")).classList.add("timeline-status"),r.innerText="None",tlElement.append(r);else{var a,i=document.createDocumentFragment(),r=o||document.getElementById("timeline-more");r&&(r.hidden=!!n);for(a of t)i.append(getPost(a));if(tlElement.append(i),e&&!currentTl.disableCaching){let e=tlCache[currentTlID];e||(e={upperBound:null,lowerBound:null,posts:[],pendingForward:[],end:!1},tlCache[currentTlID]=e),e.posts.push(...t),e.lowerBound=offset.lower,e.upperBound=offset.upper,e.end=n}}}function _setTimeline(e,t){var n=tlCache[currentTlID];n&&(n.upperBound=offset.upper,n.lowerBound=offset.lower),currentTlID=e.split("__")[0]+timelineToggles.map(e=>"__"+e).join(""),currentTl=timelines[currentTlID],tlPollingIntervalID&&(clearInterval(tlPollingIntervalID),tlPollingIntervalID=null),currentTl.disablePolling||(tlPollingIntervalID=setInterval(timelinePolling,TL_POLLING_INTERVAL)),reloadTimeline(!1,t)}function switchTimeline(e){let t=e.target;if(t){t.dataset.timelineId&&t.dataset.timelineId in timelines&&timelines[t.dataset.timelineId].url!==currentTl.url&&_setTimeline(t.dataset.timelineId);for(let e of document.querySelectorAll("[data-timeline-active]:not([data-timeline-toggle])"))delete e.dataset.timelineActive;e.target.dataset.timelineActive=""}}function toggleTimeline(e){var t,e=e.target;e&&(t=e.dataset.timelineToggle)&&("string"==typeof e.dataset.timelineActive?(delete e.dataset.timelineActive,timelineToggles.includes(t)&&timelineToggles.splice(timelineToggles.indexOf(t),1)):(e.dataset.timelineActive="",timelineToggles.push(t)),_setTimeline(currentTlID))}function getPost(e,n=!0,o=null){var a=postCache[e];if(!a)return(t=document.createElement("div")).innerText="Post couldn't be loaded.",t;var t=linkify(escapeHTML(a.content),e);n&&(!offset.lower||a.timestamp<offset.lower)&&(offset.lower=a.timestamp),n&&(!offset.upper||a.timestamp>offset.upper)&&(offset.upper=a.timestamp);let i="",r="",s=(a.content_warning&&(i=`<details class="content-warning"${!1===o||!0!==o&&!localStorage.getItem("smiggins-expand-cws")?"":" open"}><summary><div>${escapeHTML(a.content_warning)} <div class="content-warning-stats">(${a.content.length} char${1===a.content.length?"":"s"}${a.quote?", quote":""})</div></div></summary>`,r="</details>"),{hidden_if_no_quote:"hidden"}),l={};if(a.quote){n=linkify(escapeHTML(a.quote.content),a.quote.id);let e="",t="";a.quote.content_warning&&(e=`<details class="content-warning"${!1===o||!0!==o&&!localStorage.getItem("smiggins-expand-cws")?"":" open"}><summary><div>${escapeHTML(a.quote.content_warning)} <div class="content-warning-stats">(${a.quote.content.length} char${1===a.quote.content.length?"":"s"})</div></div></summary>`,t="</details>"),s={hidden_if_no_quote:"",quote_timestamp:getTimestamp(a.quote.timestamp),quote_username:a.quote.user.username,quote_private_post:a.quote.private?"data-private-post":"",quote_cw_end:t,quote_pid:String(a.quote.id),quote_comment_id:String(a.quote.comment),hidden_if_no_quote_pronouns:a.quote.user.pronouns?"":"hidden",hidden_if_no_quote_comment:a.quote.comment?"":"hidden"},l={quote_content:[n,1],quote_cw_start:[e,1],quote_pronouns:[a.quote.user.pronouns||"",1],quote_display_name:[escapeHTML(a.quote.user.display_name),1]}}o=getSnippet("post",Object.assign(Object.assign(Object.assign({timestamp:getTimestamp(a.timestamp),username:a.user.username,post_interactions_hidden:localStorage.getItem("smiggins-hide-interactions")?"hidden":"",edit_hidden:username===a.user.username?"":"hidden",delete_hidden:isAdmin||username===a.user.username?"":"hidden",pid:String(e),comment_id:String(a.comment),comments:floatintToStr(a.interactions.comments),quotes:floatintToStr(a.interactions.quotes),likes:floatintToStr(a.interactions.likes),liked:String(a.interactions.liked),private_post:a.private?"data-private-post":"",cw_end:r,hidden_if_no_pronouns:a.user.pronouns?"":"hidden",hidden_if_no_comment:a.comment?"":"hidden"},s),{content:[t,1],pronouns:[a.user.pronouns||"",1],display_name:[escapeHTML(a.user.display_name),1],cw_start:[i,1]}),l));return o.dataset.editReplace=String(e),o}function timelineShowNew(){var e,t=tlCache[currentTlID];if(t){var n=t.pendingForward;if(t.pendingForward=[],null!=(e=document.getElementById("timeline-show-new"))&&e.remove(),!1===n)reloadTimeline(!0);else{t.posts=n.reverse().concat(t.posts);var o,a,i=document.createDocumentFragment();for(o of n)i.append(getPost(o));prependedPosts=0;for(a of document.querySelectorAll("[data-prepended]"))a.remove();tlElement.prepend(i)}}}function handleForward(t,n,e,o=!1){tlPollingPendingResponse=!1;var a=tlCache[e];if(a)if(e!==currentTlID)console.log("timeline switched, discarding request"),n?a.pendingForward=!1:!1!==a.pendingForward&&a.pendingForward.push(...insertIntoPostCache(t).reverse());else if(0!==t.length&&!1!==a.pendingForward){let e=document.getElementById("timeline-show-new");o||e||n&&!(0<a.pendingForward.length+t.length-prependedPosts)||((e=document.createElement("button")).id="timeline-show-new",e.addEventListener("click",timelineShowNew),tlElement.prepend(e)),n?(offset.upper=t[0].timestamp,a.pendingForward.push(...insertIntoPostCache(t).reverse()),e&&(e.innerText=`Show new posts (${a.pendingForward.length-prependedPosts})`)):(a.pendingForward=!1,e&&(e.innerText="Refresh")),o&&timelineShowNew()}}function timelinePolling(t=!1){var e;currentTl.disablePolling||!offset.upper||tlPollingPendingResponse&&!t||(e=tlCache[currentTlID],tlPollingPendingResponse=!0,e&&!1===e.pendingForward)||(localStorage.getItem("smiggins-auto-show-posts")&&(t=!0),fetch(`${currentTl.url}${currentTl.url.includes("?")?"&":"?"}offset=${offset.upper}&forwards=true`).then(e=>e.arrayBuffer()).then(e=>parseResponse(e,(t?"$":"")+currentTlID)).catch(e=>{console.log("Something went wrong polling",e),tlPollingPendingResponse=!1}))}function prependPostToTimeline(e){var t;!currentTl.prependPosts||"number"==typeof currentTl.prependPosts&&e.comment!==currentTl.prependPosts||(tlElement.querySelector(".post")||clearTimelineStatuses(),t=document.getElementById("timeline-show-new"),(e=getPost(insertIntoPostCache([e])[0],!1)).dataset.prepended="",prependedPosts++,t?tlElement.prepend(t,e):tlElement.prepend(e))}function postButtonClick(e){var t=e.currentTarget;if(t){if(t.dataset.interactionQuote)createPostModal("quote",+t.dataset.interactionQuote);else if(t.dataset.interactionLike){var n,o=+t.dataset.interactionLike,a="true"===t.dataset.liked,i=postCache[o];i&&(i.interactions.liked=!a,i.interactions.likes+=2*(.5-a));for(n of document.querySelectorAll(`[data-interaction-like="${o}"]`)){n.dataset.liked=String(!a);var r=n.querySelector("[data-number]");r&&!isNaN(+r.innerText)&&(r.innerText=String(+r.innerText+2*(.5-a)))}fetch("/api/post/like/"+o,{method:a?"DELETE":"POST"}).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e})}else t.dataset.interactionEdit?createPostModal("edit",+t.dataset.interactionEdit):t.dataset.interactionPin?(i=+t.dataset.interactionPin,fetch("/api/post/pin/"+i,{method:"POST"}).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e})):t.dataset.interactionUnpin?fetch("/api/post/pin",{method:"DELETE"}).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e}):t.dataset.interactionDelete?(o=+t.dataset.interactionDelete,fetch("/api/post",{method:"DELETE",body:buildRequest([[o,32]])}).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e})):console.log("Unknown interaction type for post button",e);e.preventDefault()}}function createPost(e,t,n,o,a){fetch("/api/post",{method:"POST",body:buildRequest([n,Boolean(a&&a.quote),Boolean(a&&a.poll&&a.poll.length),Boolean(a&&a.comment),[e,16],[t||"",8],...a&&a.poll?[[a.poll.length,8],...a.poll.map(e=>[e,8])]:[],...a&&a.quote?[[a.quote,32]]:[],...a&&a.comment?[[a.comment,32]]:[]])}).then(e=>e.arrayBuffer()).then(e=>(o&&o(!(new Uint8Array(e)[0]>>7&1)),e)).then(parseResponse).catch(e=>{throw o&&o(!1),createToast("Something went wrong!",String(e)),e})}function handlePostDelete(e){for(var t of Object.values(tlCache))for(;null!=t&&t.posts.includes(e);)t.posts.splice(t.posts.indexOf(e),1);for(var n of document.querySelectorAll(`[data-post-id="${e}"]`))n.innerHTML="<i>This post has been deleted.</i>";delete tlCache[`post_${e}_recent`],delete tlCache[`post_${e}_oldest`],getPostIDFromPath()===e&&(currentPage="home",history.pushState("home","","/"),renderPage("home"));for(var[o,a]of Object.entries(postCache))(null==a?void 0:a.comment)===e&&(delete postCache[+o],handlePostDelete(+o))}function simplePostContent(e){return escapeHTML(e.content_warning?"CW: "+e.content_warning:e.content)}function p_tlMore(e){let t=e.querySelector('[id="timeline-more"]');t&&t.addEventListener("click",()=>{t.setAttribute("hidden",""),loadMorePosts()})}function p_tlSwitch(e){var t,n,o=e.querySelectorAll("[data-timeline-id]"),e=e.querySelectorAll("[data-timeline-toggle]");for(t of o)t.addEventListener("click",switchTimeline);for(n of e)n.addEventListener("click",toggleTimeline)}function p_post(e){var t;null!=(t=e.querySelector("[data-interaction-comment]"))&&t.addEventListener("click",postButtonClick),null!=(t=e.querySelector("[data-interaction-quote]"))&&t.addEventListener("click",postButtonClick),null!=(t=e.querySelector("[data-interaction-like]"))&&t.addEventListener("click",postButtonClick),null!=(t=e.querySelector("[data-interaction-edit]"))&&t.addEventListener("click",postButtonClick),null!=(t=e.querySelector("[data-interaction-pin]"))&&t.addEventListener("click",postButtonClick),null!=(t=e.querySelector("[data-interaction-delete]"))&&t.addEventListener("click",postButtonClick)}function createToast(t,n,o){if(t){let e=getSnippet("toast",{title:t,content:n||""});null!=(t=document.getElementById("toasts"))&&t.append(e),e.addEventListener("click",()=>e.remove()),setTimeout(()=>e.remove(),o||3e3)}}function inputEnterEvent(e){var t,n;"Enter"===e.key&&(t=e.currentTarget,t=e.ctrlKey&&t.dataset.enterSubmit||t.dataset.enterNext||t.dataset.enterSubmit)&&"!avoid"!==t&&(n=document.querySelector(t))&&(n.focus(),"BUTTON"===n.nodeName&&n.click(),e.preventDefault())}function togglePasswords(e){let t,n,o="";var a,i,e=e.target;if(o=e?e.dataset.passwordToggle||"":o){t=[],n=[];for(var r of o.split(",")){r=document.querySelector(r.trim());r&&("password"===r.type?t:n).push(r)}}else t=[...document.querySelectorAll('input[type="password"]')],n=[...document.querySelectorAll("input[data-toggle-password]")];for(a of t)a.type="text",a.dataset.togglePassword="";for(i of n)i.type="password",delete i.dataset.togglePassword}function sha256(t){function n(e,t){return e>>>t|e<<32-t}var e=Math.pow(2,32);let o="";var a=[],i=8*t.length;let r=[];var s=[];let l=s.length;var c={};for(let t=2;l<64;t++)if(!c[t]){for(let e=0;e<313;e+=t)c[e]=t;r[l]=Math.pow(t,.5)*e|0,s[l++]=Math.pow(t,1/3)*e|0}for(t+="Â€";t.length%64-56;)t+="\0";for(let e=0;e<t.length;e++){var d=t.charCodeAt(e);if(d>>8)return"";a[e>>2]|=d<<(3-e)%4*8}a[a.length]=i/e|0,a[a.length]=i;for(let e=0;e<a.length;){var u=a.slice(e,e+=16),m=r;r=r.slice(0,8);for(let e=0;e<64;e++){var p=u[e-15],g=u[e-2],h=r[0],f=r[4],f=r[7]+(n(f,6)^n(f,11)^n(f,25))+(f&r[5]^~f&r[6])+s[e]+(u[e]=e<16?u[e]:u[e-16]+(n(p,7)^n(p,18)^p>>>3)+u[e-7]+(n(g,17)^n(g,19)^g>>>10)|0),p=(n(h,2)^n(h,13)^n(h,22))+(h&r[1]^h&r[2]^r[1]&r[2]);(r=[f+p|0].concat(r))[4]=r[4]+f|0}for(let e=0;e<8;e++)r[e]=r[e]+m[e]|0}for(let t=0;t<8;t++)for(let e=3;e+1;e--){var v=r[t]>>8*e&255;o+=(v<16?0:"")+v.toString(16)}return o}function escapeHTML(e){return void 0===e?"âš ï¸":e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll('"',"&quot;").replaceAll("`","&#96;")}function unescapeHTML(e){return void 0===e?"âš ï¸":e.replaceAll("&#96;","`").replaceAll("&quot;",'"').replaceAll("&lt;","<").replaceAll("&amp;","&")}function getTimestamp(e,t=!1){let n=Math.round(Date.now()/1e3-e);var o=n<0,a=!!localStorage.getItem("smiggins-complex-timestamps");let i="?";return(n=o?-n:n)<60?i=n+"s":n<3600?i=Math.floor(n/60)+"m"+(a?n%60+"s":""):n<86400?i=Math.floor(n/60/60)+"h"+(a?Math.floor(n/60)%60+"m":""):n<31536e3?i=Math.floor(n/60/60/24)+"d"+(a?Math.floor(n/60/60)%24+"h":""):isNaN(e)||(i=Math.floor(n/60/60/24/365)+"y"+(a?Math.floor(n/60/60/24)%365+"d":"")),o&&(i="in "+i),t?i:`<span data-timestamp="${e}">${i}</span>`}function updateTimestamps(){var e;for(e of document.querySelectorAll("[data-timestamp]")){var t=getTimestamp(+(e.dataset.timestamp||NaN),!0);t!==e.innerText&&(e.innerText=t)}}function setTokenCookie(e){document.cookie=`token=${e};Path=/;SameSite=Lax;Expires=`+new Date(Date.now()+307584e5).toUTCString()}function genericCheckbox(t){return function(e){e=e.target;e&&(e.checked?localStorage.setItem(t,"1"):localStorage.removeItem(t))}}function getMentionsFromPost(e){e=[...new Set([[null,e.user.username],...e.content.matchAll(mentionRegex)].map(e=>e[1].toLowerCase()))].sort((e,t)=>e<t?-1:1);return e.includes(username)&&e.splice(e.indexOf(username),1),e}function p_folreq(e){var t=e.querySelector("#timeline-posts");t&&hookTimeline(t,{notifications:{url:"/api/timeline/follow-requests",disableCaching:!0,disablePolling:!0,prependPosts:!1,customRender:renderFolreqTimeline}},"notifications",e)}function renderFolreqTimeline(e,t,n,o){var a;if(clearTimelineStatuses(),null===offset.lower&&0===e.length)(s=document.createElement("i")).classList.add("timeline-status"),s.innerText="None",tlElement.append(s);else{var i,r=document.createDocumentFragment(),s=o||document.getElementById("timeline-more");s&&(s.hidden=!!t);for(i of e){var l=getSnippet("folreq-user",{username:i.username,bio:[linkify(escapeHTML(i.bio)),1],display_name:[linkify(escapeHTML(i.display_name)),1]});null!=(a=l.querySelector("[data-folreq-interaction-accept]"))&&a.addEventListener("click",folreqInteraction),null!=(a=l.querySelector("[data-folreq-interaction-deny]"))&&a.addEventListener("click",folreqInteraction),null!=(a=l.querySelector("[data-folreq-interaction-block]"))&&a.addEventListener("click",folreqInteraction),l.dataset.folreqRemove=i.username,r.append(l)}tlElement.append(r)}}function folreqInteraction(e){var t,n,e=e.currentTarget;e&&(e.dataset.folreqInteractionAccept||e.dataset.folreqInteractionDeny?(n=e.dataset.folreqInteractionAccept||e.dataset.folreqInteractionDeny||"",null!=(t=document.querySelector(`[data-folreq-remove="${n}"]`))&&t.remove(),fetch("/api/user/follow-request",{method:e.dataset.folreqInteractionAccept?"POST":"DELETE",body:n}).then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e})):e.dataset.folreqInteractionBlock&&(null!=(t=document.querySelector(`[data-folreq-remove="${e.dataset.folreqInteractionBlock}"]`))&&t.remove(),blockUser(e.dataset.folreqInteractionBlock,!0)))}function getHashtagFromPath(e){return(e||location.pathname).toLowerCase().split("/").filter(Boolean)[1]}function p_hashtag(e){var t=e.querySelector("#timeline-posts"),n=getHashtagFromPath();t&&n&&hookTimeline(t,{[`hashtag_${n}_recent`]:{url:`/api/timeline/tag/${n}?sort=recent`,prependPosts:!1},[`hashtag_${n}_oldest`]:{url:`/api/timeline/tag/${n}?sort=oldest`,prependPosts:!1,disablePolling:!0}},`hashtag_${n}_recent`,e)}function p_home(e){hookTimeline(e.querySelector('[id="timeline-posts"]'),{following:{url:"/api/timeline/following",prependPosts:!0},global:{url:"/api/timeline/global",prependPosts:!0},following__comments:{url:"/api/timeline/following?comments=true",prependPosts:!0},global__comments:{url:"/api/timeline/global?comments=true",prependPosts:!0}},"global",e),null!=(e=e.querySelector("#post"))&&e.addEventListener("click",homeCreatePost)}function homeCreatePost(n){let e,o=document.getElementById("post-cw"),a=document.getElementById("post-content");var t,i,r=document.getElementById("post-private");o&&a&&r&&(t=o.value,i=a.value,r=r.checked,i?(null!=(e=n.target)&&e.setAttribute("disabled",""),createPost(i,t||null,r,e=>{var t;null!=(t=n.target)&&t.removeAttribute("disabled"),a.focus(),e&&(o.value="",a.value="")})):a.focus())}function loginSubmitEvent(n){var e,t,o,a=document.getElementById("username"),i=document.getElementById("password");a&&i&&(t=a.value,o=i.value,t?o?(null!=(e=n.target)&&e.setAttribute("disabled",""),fetch("/api/user/login",{method:"POST",body:buildRequest([[t,8],hexToBytes(sha256(o))])}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{var e;return null==(e=n.target)?void 0:e.removeAttribute("disabled")}).catch(e=>{var t;throw null!=(t=n.target)&&t.removeAttribute("disabled"),createToast("Something went wrong!",String(e)),e})):i.focus():a.focus())}function signupSubmitEvent(n){var t=document.getElementById("username"),o=document.getElementById("password"),a=document.getElementById("confirm"),i=document.getElementById("otp");if(t&&o&&a){var r=t.value,s=o.value,l=a.value;let e=null;i&&(e=i.value),i&&!e?i.focus():r?s?s!==l?(a.focus(),createToast("Passwords don't match.")):(null!=(i=n.target)&&i.setAttribute("disabled",""),fetch("/api/user/signup",{method:"POST",body:buildRequest([[r,8],hexToBytes(sha256(s)),[e||"",8]])}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{var e;return null==(e=n.target)?void 0:e.removeAttribute("disabled")}).catch(e=>{var t;throw null!=(t=n.target)&&t.removeAttribute("disabled"),createToast("Something went wrong!",String(e)),e})):o.focus():t.focus()}}function p_login(e){e.querySelector("#submit").addEventListener("click",loginSubmitEvent)}function p_signup(e){null!=(e=e.querySelector("#submit"))&&e.addEventListener("click",signupSubmitEvent)}function p_logout(e){document.cookie="token=;Path=/;Expires=Thu, 01 Jan 1970 00:00:01 GMT;",location.href="/"}setInterval(updateTimestamps,1e3);let NUM_USERS_LIKE_NOTIF=4;function p_notifications(e){pendingNotifications.notifications=!1;var t=e.querySelector("#timeline-posts");t&&hookTimeline(t,{notifications:{url:"/api/timeline/notifications",disableCaching:!0,prependPosts:!1,customRender:renderNotificationTimeline,customForward:handleNotificationForward}},"notifications",e)}function _getLikeNotification(e){var t=e.map((e,t)=>((!offset.lower||e.timestamp<offset.lower)&&(offset.lower=e.timestamp),(!offset.upper||e.timestamp>offset.upper)&&(offset.upper=e.timestamp),t>NUM_USERS_LIKE_NOTIF?null:[e.user.username,e.user.display_name])).map(e=>{if(null===e)return"";let t="<b>",n="</b>";return e[0]&&(t+=`<a class="plain-link" data-internal-link="user" href="/u/${e[0]}/">`,n="</a>"+n),t+escapeHTML(e[1])+n}),n=e.length-t.length;let o;return o=0==n?1===t.length?t[0]:2===t.length?t.join(" and "):(t[t.length-1]="and "+t[t.length-1],t.join(", ")):1==n?t.join(", ")+", and <b>1 other</b>":t.join(", ")+`, and <b>${n} others</b>`,getSnippet("notification-like",{pid:String(e[0].id),content:[simplePostContent(e[0]),1],names:[o,1]})}function renderNotificationTimeline(n,o,e,a,i=!1){if(console.log(n),clearTimelineStatuses(),null===offset.lower&&0===n.length)(s=document.createElement("i")).classList.add("timeline-status"),s.innerText="None",tlElement.append(s);else{var r,s,l=document.createDocumentFragment();let e=[],t=!1;for(r of n){var c=127&r[1],d=!(128&r[1]);!t&&d&&(t=!0,e.length)&&(l.append(_getLikeNotification(e)),e=[]),c===NotificationCodes.Like?(e.length&&e[0].id!==r[0].id&&(c=_getLikeNotification(e),d&&(c.dataset.notificationRead=""),l.append(c),e=[]),e.push(r[0])):(e.length&&(c=_getLikeNotification(e),d&&(c.dataset.notificationRead=""),l.append(c),e=[]),c=getPost(insertIntoPostCache([r[0]])[0]),d&&(c.dataset.notificationRead=""),l.append(c))}e.length&&(s=_getLikeNotification(e),t&&(s.dataset.notificationRead=""),l.append(s)),i?tlElement.prepend(l):(tlElement.append(l),(n=a||document.getElementById("timeline-more"))&&(n.hidden=!!o))}}function handleNotificationForward(e,t,n="notifications",o){tlPollingPendingResponse=!1,n!==currentTlID?console.log("timeline switched, discarding request"):0!==e.length&&(t?renderNotificationTimeline(e.reverse(),!1,!1,null,!0):reloadTimeline(!0))}(e=>{e[e.Comment=1]="Comment",e[e.Quote=2]="Quote",e[e.Ping=3]="Ping",e[e.Like=4]="Like"})(NotificationCodes=NotificationCodes||{});let commentBoxValueSet=!1;function getPostIDFromPath(e){return+(e||location.pathname).split("/").filter(Boolean)[1]}function postSetDNE(){var e,t,n=document.createElement("div");n.innerText="This post doesn't exist.",n.classList.add("generic-margin-top"),null!=(e=document.getElementById("focused-post"))&&e.replaceChildren(n),null!=(e=document.getElementById("comment-parent"))&&e.setAttribute("hidden",""),null!=(n=document.getElementById("home-link"))&&n.removeAttribute("hidden");for(t of document.querySelectorAll("#focused-post + hr ~ *"))t.setAttribute("hidden","")}function updateFocusedPost(e){var t=insertIntoPostCache([e])[0],n=document.querySelector("#focused-post .content-warning"),o=(null!=(o=document.getElementById("focused-post"))&&o.replaceChildren(getPost(t,!1,n?n.open:null)),e.comment?(null!=(o=document.getElementById("comment-parent"))&&o.removeAttribute("hidden"),null!=(n=document.getElementById("comment-parent"))&&n.setAttribute("href",`/p/${e.comment}/`),null!=(o=document.getElementById("home-link"))&&o.setAttribute("hidden","")):(null!=(n=document.getElementById("comment-parent"))&&n.setAttribute("hidden",""),null!=(e=document.getElementById("home-link"))&&e.removeAttribute("hidden")),document.getElementById("post-content")),n=postCache[t];!commentBoxValueSet&&o&&!o.value&&n&&(commentBoxValueSet=!0,o.value=getMentionsFromPost(n).map(e=>`@${e} `).join(""))}function createComment(n){let e,o=document.getElementById("post-cw"),a=document.getElementById("post-content");var t,i,r=document.getElementById("post-private");o&&a&&r&&(t=o.value,i=a.value,r=r.checked,i?(null!=(e=n.target)&&e.setAttribute("disabled",""),createPost(i,t||null,r,e=>{var t;null!=(t=n.target)&&t.removeAttribute("disabled"),a.focus(),e&&(o.value="",t=postCache[getPostIDFromPath()],a.value=t?getMentionsFromPost(t).map(e=>`@${e} `).join(""):"")},{comment:getPostIDFromPath()})):a.focus())}function p_postPage(e){var t,n=getPostIDFromPath(),o=postCache[n],a=e.querySelector("#focused-post"),i=e.querySelector("#timeline-posts");commentBoxValueSet=!1,i&&a&&(o?((t=e.querySelector("#post-content"))&&(t.value=getMentionsFromPost(o).map(e=>`@${e} `).join("")),a.replaceChildren(getPost(n,!1))):a.replaceChildren(getSnippet("post-placeholder")),hookTimeline(i,{[`post_${n}_recent`]:{url:`/api/timeline/post/${n}?sort=recent`,prependPosts:n},[`post_${n}_oldest`]:{url:`/api/timeline/post/${n}?sort=oldest`,prependPosts:!1,disablePolling:!0}},`post_${n}_recent`,e),null!=(t=e.querySelector("#post")))&&t.addEventListener("click",createComment)}function updateBannerColors(){var e=document.getElementById("banner-example"),t=document.getElementById("banner-gradient"),n=document.getElementById("banner-one"),o=document.getElementById("banner-two");e&&(n&&(e.style.setProperty("--color-one",n.value),t)&&!t.checked&&e.style.setProperty("--color-two",n.value),!o||t&&!t.checked||e.style.setProperty("--color-two",o.value))}function updateUserCacheFromCosmeticSettings(){var e=userCache[username],t=document.getElementById("display-name"),n=document.getElementById("bio"),o=document.getElementById("banner-gradient"),a=document.getElementById("banner-one"),i=document.getElementById("banner-two");t&&n&&o&&a&&i&&e&&(e.color_one=a.value,e.color_two=(o.checked?i:a).value,e.display_name=t.value,e.bio=n.value)}function setFontSize(e){e=e.currentTarget;e&&(localStorage.setItem("smiggins-font-size",e.id.slice(10)),document.body.dataset.fontSize=e.id.slice(10))}function saveProfile(n){var e,t=document.getElementById("display-name"),o=document.getElementById("bio"),a=document.getElementById("banner-gradient"),i=document.getElementById("banner-one"),r=document.getElementById("banner-two"),s=document.getElementById("pronouns"),l=document.getElementById("pronouns-custom");t&&o&&a&&i&&r&&s&&l&&(null!=(e=n.target)&&e.setAttribute("disabled",""),fetch("/api/user",{method:"PATCH",body:buildRequest([a.checked,[t.value,8],[o.value,16],[("custom"===s.value?l:s).value,8],hexToBytes(i.value.slice(1)),hexToBytes(r.value.slice(1))])}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{var e;null!=(e=n.target)&&e.removeAttribute("disabled")}).catch(e=>{var t;throw null!=(t=n.target)&&t.removeAttribute("disabled"),createToast("Something went wrong!",String(e)),e}))}function saveDefaultVisibility(){var e;defaultPostPrivate="true"===(null==(e=document.getElementById("default-private"))?void 0:e.value),snippetVariables.selected_if_default_private=defaultPostPrivate?"selected":"",snippetVariables.checked_if_default_private=defaultPostPrivate?"checked":"",fetch("/api/user/default_post",{method:"PATCH",body:buildRequest([[+defaultPostPrivate,8]])}).then(e=>e.arrayBuffer()).then(parseResponse)}function saveVerifyFollowers(){var e;fetch("/api/user/verify_followers",{method:"PATCH",body:buildRequest([[+((null==(e=document.getElementById("verify-followers"))?void 0:e.checked)||!1),8]])}).then(e=>e.arrayBuffer()).then(parseResponse)}function settingsThemeSelection(){var e=document.getElementById("theme");!e||"light"!==(e=e.value)&&"dark"!==e&&"system"!==e||setTheme(e)}function changePasswordSuccess(e){setTokenCookie(e),createToast("Success!","Your password has been changed.");var e=document.getElementById("password-current"),t=document.getElementById("password-new"),n=document.getElementById("password-confirm");e&&t&&n&&(e.value="",t.value="",n.value="")}function changePassword(n){var e,t,o,a=document.getElementById("password-current"),i=document.getElementById("password-new"),r=document.getElementById("password-confirm");a&&i&&r&&(e=a.value,t=i.value,o=r.value,e?t?o!==t?r.focus():(null!=(o=n.target)&&o.setAttribute("disabled",""),fetch("/api/user/password",{method:"PATCH",body:buildRequest([hexToBytes(sha256(e)),hexToBytes(sha256(t))])}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{var e;null!=(e=n.target)&&e.removeAttribute("disabled")}).catch(e=>{var t;throw null!=(t=n.target)&&t.removeAttribute("disabled"),createToast("Something went wrong!",String(e)),e})):i.focus():a.focus())}function deleteAccount(n){var e,t,o=document.getElementById("delete-acc-password"),a=document.getElementById("delete-acc-confirm");o&&a&&(e=o.value,t=a.checked,e?t?(null!=(t=n.target)&&t.setAttribute("disabled",""),fetch("/api/user",{method:"DELETE",body:buildRequest([hexToBytes(sha256(e))])}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{var e;null!=(e=n.target)&&e.removeAttribute("disabled")}).catch(e=>{var t;throw null!=(t=n.target)&&t.removeAttribute("disabled"),createToast("Something went wrong!",String(e)),e})):a.focus():o.focus())}function profileSettingsSetUserData(e,t,n,o,a,i,r){var s=document.getElementById("display-name"),l=document.getElementById("bio"),c=document.getElementById("banner-gradient"),d=document.getElementById("banner-one"),u=document.getElementById("banner-two"),m=document.getElementById("verify-followers");let p=document.getElementById("pronouns"),g=document.getElementById("pronouns-custom");s&&(s.value=e),l&&(l.value=t),c&&(c.checked=i),d&&(d.value=o,d.addEventListener("input",updateBannerColors)),u&&(u.value=a,u.addEventListener("input",updateBannerColors)),m&&(m.checked=r,m.addEventListener("input",saveVerifyFollowers)),p&&g&&(p.addEventListener("input",function(){"custom"===p.value?g.removeAttribute("hidden"):g.setAttribute("hidden","")}),""!==n)&&(["he/him","she/her","they/them","it/its"].includes(n)?(p.value=n,g.setAttribute("hidden","")):(p.value="custom",g.value=n,g.removeAttribute("hidden"))),null!=(s=document.getElementById("profile-save"))&&s.addEventListener("click",saveProfile),null!=(l=document.getElementById("default-private"))&&l.addEventListener("input",saveDefaultVisibility),null!=(c=document.getElementById("banner-gradient"))&&c.addEventListener("input",updateBannerColors);var h,d=userCache[username];d&&(d.color_one=o,d.color_two=i?a:o,d.display_name=e,d.bio=t),updateBannerColors();for(h of document.querySelectorAll("[data-disabled-while-loading]"))h.removeAttribute("disabled")}function setKeybindElementData(e,t){var n=keybinds[e],o=_kbGetKey(e),a=o[0]+o.slice(1).split(":")[0],o=o.slice(1).split(":")[1].split(",").map(e=>({alt:"Alt + ",ctrl:"Ctrl + ",nav:_kbGetKey("navModifier")[0]+_kbGetKey("navModifier").slice(1).split(":")[0]+" + ",shift:"Shift + "})[e]).join("");let i=`<div class="generic-margin-top">${escapeHTML(n.name)}: <code class="kb-key">${escapeHTML(o+a)}</code> <button data-kb-id="${e}">Change</button></div>`;n.description&&(i+=`<small><div>${escapeHTML(n.description)}</div></small>`),t.innerHTML=i,null!=(o=t.querySelector("button"))&&o.addEventListener("click",()=>{modifyKeybindModal(e)})}function p_settingsProfile(e){fetch("/api/user").then(e=>e.arrayBuffer()).then(parseResponse).catch(e=>{throw createToast("Something went wrong!",String(e)),e})}function p_settingsCosmetic(e){var t,n;null!=(t=e.querySelector(`#theme > option[value="${theme}"]`))&&t.setAttribute("selected",""),localStorage.getItem("smiggins-complex-timestamps")&&null!=(t=e.querySelector("#complex-timestamps"))&&t.setAttribute("checked",""),localStorage.getItem("smiggins-expand-cws")&&null!=(t=e.querySelector("#expand-cws"))&&t.setAttribute("checked",""),localStorage.getItem("smiggins-hide-interactions")&&null!=(t=e.querySelector("#hide-interactions"))&&t.setAttribute("checked",""),localStorage.getItem("smiggins-auto-show-posts")&&null!=(t=e.querySelector("#auto-show"))&&t.setAttribute("checked",""),null!=(t=e.querySelector("#theme"))&&t.addEventListener("change",settingsThemeSelection),null!=(t=e.querySelector("#complex-timestamps"))&&t.addEventListener("change",genericCheckbox("smiggins-complex-timestamps")),null!=(t=e.querySelector("#expand-cws"))&&t.addEventListener("change",genericCheckbox("smiggins-expand-cws")),null!=(t=e.querySelector("#hide-interactions"))&&t.addEventListener("change",genericCheckbox("smiggins-hide-interactions")),null!=(t=e.querySelector("#auto-show"))&&t.addEventListener("change",genericCheckbox("smiggins-auto-show-posts"));for(n of e.querySelectorAll("#font-size-selection > div"))n.addEventListener("click",setFontSize)}function p_settingsAccount(e){var t;null!=(t=e.querySelector("#password-set"))&&t.addEventListener("click",changePassword),null!=(t=e.querySelector("#delete-acc"))&&t.addEventListener("click",deleteAccount)}function p_settingsKeybinds(e){for(var t of e.querySelectorAll(".kb-input")){var n=t.dataset.kbId||"";n in keybinds&&setKeybindElementData(n,t)}}document.body.dataset.fontSize=localStorage.getItem("smiggins-font-size")||"normal";let colorRegex=/^#[0-9a-f]{6}$/;function getUsernameFromPath(e){return(e||location.pathname).toLowerCase().split("/").filter(Boolean)[1]}function p_user(e){var t,n=getUsernameFromPath(),o="user_"+n;null!=(t=e.querySelector("#follow"))&&t.addEventListener("click",toggleFollow),null!=(t=e.querySelector("#block"))&&t.addEventListener("click",toggleBlock),hookTimeline(e.querySelector('[id="timeline-posts"]'),{[o]:{url:"/api/timeline/user/"+n,prependPosts:username===n},[o+"_all"]:{url:`/api/timeline/user/${n}?include_comments=true`,prependPosts:username===n}},o,e)}function userSetDNE(){var e=document.getElementById("timeline-posts");e&&(e.innerHTML=`<i class="timeline-status">User '${escapeHTML(getUsernameFromPath())}' does not exist.</i>`)}function userUpdateStats(e,t,n,o,a,i,r,s,l,c){var d=getUsernameFromPath();let u=userCache[d];u?(u.display_name=e,u.pronouns=t||null,u.bio=n,u.color_one=o,u.color_two=a,u.following=i,u.blocking=r,u.num_following=s,u.num_followers=l,u.pinned=c):(u={display_name:e||username,pronouns:t||null,bio:n,color_one:o||"var(--background-mid)",color_two:a||"var(--background-mid)",following:i||!1,blocking:r||!1,num_following:s||0,num_followers:l||0,pinned:c},userCache[d]=u),username!==d&&(null!=(p=document.getElementById("user-interactions"))&&p.removeAttribute("hidden"),p=document.getElementById("follow"),g=document.getElementById("block"),p&&("pending"===i?(p.innerText="Pending",p.dataset.unfollow=""):i?(p.innerText="Unfollow",p.dataset.unfollow=""):(p.innerText="Follow",delete p.dataset.unfollow)),g)&&(r?(g.innerText="Unblock",g.dataset.unblock=""):(g.innerText="Block",delete g.dataset.unblock));i=document.getElementById("bio");i&&(i.innerHTML=linkify(escapeHTML(n)));let m="";Object.values(pendingNotifications).some(Boolean)&&(m="â€¢ "),document.title=""+m+e+" - "+pageTitle;var p=document.getElementById("display-name"),r=(p&&(p.innerText=e),document.getElementById("username")),g=(r&&(r.innerText="@"+d+(t&&" - ")+t),document.getElementById("user-banner")),i=(g&&(colorRegex.test(o)&&g.style.setProperty("--color-one",o),colorRegex.test(a))&&g.style.setProperty("--color-two",a),document.getElementById("user-pinned-container")),r=(i&&(c?(i.removeAttribute("hidden"),(n=document.getElementById("user-pinned"))&&!n.querySelector(`[data-post-id="${c}"]`)&&(p=getPost(c,!1),d===username&&(e=p.querySelector("[data-interaction-pin]"))&&(delete e.dataset.interactionPin,e.dataset.interactionUnpin=String(c),e.innerHTML=icons.unpin+" Unpin"),n.replaceChildren(p))):i.setAttribute("hidden","")),document.getElementById("following")),t=document.getElementById("followers");r&&(r.innerText=floatintToStr(s)),t&&(t.innerText=floatintToStr(l))}function updateFollowButton(e,t){var n,o=document.getElementById("follow");o&&(n=userCache[username],e?t?(o.innerText="Pending",o.dataset.unfollow="",n&&(n.following="pending")):(o.innerText="Unfollow",o.dataset.unfollow="",n&&(n.following=!0)):(o.innerText="Follow",delete o.dataset.unfollow,n&&(n.following=!1)))}function updateBlockButton(e){var t=document.getElementById("block");t&&(e?(t.innerText="Unblock",t.dataset.unblock="",(e=document.getElementById("follow"))&&void 0!==e.dataset.unfollow&&(delete e.dataset.unfollow,e.innerText="Follow")):(t.innerText="Block",delete t.dataset.unblock))}function toggleFollow(e){let t=e.target;t&&(e=void 0!==t.dataset.unfollow,t.disabled=!0,fetch("/api/user/follow",{method:e?"DELETE":"POST",body:getUsernameFromPath()}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{t.disabled=!1}).catch(e=>{throw t.disabled=!1,createToast("Something went wrong!",String(e)),e}))}function toggleBlock(e){var t,e=e.target;e&&(t=void 0!==e.dataset.unblock,e.disabled=!0,blockUser(getUsernameFromPath(),!t,e))}function blockUser(e,t,n){fetch("/api/user/block",{method:t?"POST":"DELETE",body:e}).then(e=>e.arrayBuffer()).then(parseResponse).then(()=>{n&&(n.disabled=!1)}).catch(e=>{throw n&&(n.disabled=!1),createToast("Something went wrong!",String(e)),e})}