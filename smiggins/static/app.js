"use strict";const container=document.getElementById("container");function urlToIntent(path){path=normalizePath(path);if(loggedIn){switch(path){case"/home/":history.pushState("home","","/");case"/":return"home";case"/settings/":return"settings";case/^\/u\/[a-z0-9_\-]+\/$/.test(path)?path:"":return"user"}}else{switch(path){case"/":return"index";case"/login/":return"login";case"/signup/":return"signup"}}switch(path){case"/logout/":return"logout";default:return"404"}}function generateInternalLinks(element){if(!element){element=container}let links=element.querySelectorAll("[data-internal-link]:not([data-link-processed])");for(const i of links){i.dataset.linkProcessed="";i.addEventListener("click",internalLinkHandler)}}function internalLinkHandler(e){if(!e.ctrlKey){let el=e.currentTarget;let newPage=el.dataset.internalLink;let newURL=el.href||null;if(newPage!==currentPage){history.pushState(newPage,"",newURL);renderPage(newPage);currentPage=newPage}e.preventDefault()}}function normalizePath(path){if(!path.endsWith("/")){path+="/"}if(!path.startsWith("/")){path="/"+path}return path.toLowerCase()}onpopstate=function(e){currentPage=e.state;renderPage(currentPage)};function renderPage(intent){let extraVariables={};switch(intent){case"user":extraVariables={user_username:getUsernameFromPath(),display_name:getUsernameFromPath(),color_one:"var(--background-mid)",color_two:"var(--background-mid)",following:"0",followers:"0"};break}let snippet=getSnippet(`pages/${intent}`,extraVariables);container.replaceChildren(snippet)}var _a,_b,_c;const icons={icon_private:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Private post"><path d="M130.9 168.3v54.4h136v-54.4c0-37.57-30.43-68-68-68s-68 30.43-68 68m-40.8 54.4v-54.4c0-60.095 48.705-108.8 108.8-108.8s108.8 48.705 108.8 108.8v54.4h27.2c30.005 0 54.4 24.395 54.4 54.4v163.2c0 30.005-24.395 54.4-54.4 54.4h-272c-30.005 0-54.4-24.395-54.4-54.4V277.1c0-30.005 24.395-54.4 54.4-54.4zm-40.8 54.4v163.2c0 7.48 6.12 13.6 13.6 13.6h272c7.48 0 13.6-6.12 13.6-13.6V277.1c0-7.48-6.12-13.6-13.6-13.6h-272c-7.48 0-13.6 6.12-13.6 13.6"/></svg>',icon_home_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-label="Home"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1H392c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.6H32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24"/></svg>',icon_home:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-label="Home"><path d="M303.5 5.7c-9-7.6-22.1-7.6-31.1 0l-264 224c-10.1 8.6-11.3 23.7-2.8 33.8s23.7 11.3 33.8 2.8L64 245.5V432c0 44.2 35.8 80 80 80h288c44.2 0 80-35.8 80-80V245.5l24.5 20.8c10.1 8.6 25.3 7.3 33.8-2.8s7.3-25.3-2.8-33.8zM112 432V204.8L288 55.5l176 149.3V432c0 17.7-14.3 32-32 32h-48V312c0-22.1-17.9-40-40-40H232c-22.1 0-40 17.9-40 40v152h-48c-17.7 0-32-14.3-32-32m128 32V320h96v144z"/></svg>',icon_notifications_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Notifications"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416h384c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3c-31.2-35.2-48.5-80.5-48.5-127.6V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m45.3 493.3c12-12 18.7-28.3 18.7-45.3H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7"/></svg>',icon_notifications:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Notifications"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v25.4c0 45.4-15.5 89.5-43.8 124.9L5.3 377c-5.8 7.2-6.9 17.1-2.9 25.4S14.8 416 24 416h400c9.2 0 17.6-5.3 21.6-13.6s2.9-18.2-2.9-25.4l-14.9-18.6c-28.3-35.5-43.8-79.6-43.8-125V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m0 96c61.9 0 112 50.1 112 112v25.4c0 47.9 13.9 94.6 39.7 134.6H72.3c25.8-40 39.7-86.7 39.7-134.6V208c0-61.9 50.1-112 112-112m64 352H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7S288 465 288 448"/></svg>',icon_messages_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Messages"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>',icon_messages:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Messages"><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>',icon_user_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Profile"><path d="M224 256a128 128 0 1 0 0-256 128 128 0 1 0 0 256m-45.7 48C79.8 304 0 383.8 0 482.3 0 498.7 13.3 512 29.7 512h388.6c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3z"/></svg>',icon_user:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Profile"><path d="M304 128a80 80 0 1 0-160 0 80 80 0 1 0 160 0m-208 0a128 128 0 1 1 256 0 128 128 0 1 1-256 0M49.3 464h349.5c-8.9-63.3-63.3-112-129-112h-91.4c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3"/></svg>',icon_settings_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Settings"><path d="M495.9 166.6c3.2 8.7.5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4l-55.6 17.8c-8.8 2.8-18.6.3-24.5-6.8-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4c-1.1-8.4-1.7-16.9-1.7-25.5s.6-17.1 1.7-25.4l-43.3-39.4c-6.9-6.2-9.6-15.9-6.4-24.6 4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2 5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8 8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160"/></svg>',icon_settings:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Settings"><path d="M256 0c17 0 33.6 1.7 49.8 4.8 7.9 1.5 21.8 6.1 29.4 20.1 2 3.7 3.6 7.6 4.6 11.8l9.3 38.5c1.4 5.8 11.2 11.5 16.9 9.8l38-11.2c4-1.2 8.1-1.8 12.2-1.9 16.1-.5 27 9.4 32.3 15.4 22.1 25.1 39.1 54.6 49.9 86.3 2.6 7.6 5.6 21.8-2.7 35.4-2.2 3.6-4.9 7-8 10L459 246.3c-4.2 4-4.2 15.5 0 19.5l28.7 27.3c3.1 3 5.8 6.4 8 10 8.2 13.6 5.2 27.8 2.7 35.4-10.8 31.7-27.8 61.1-49.9 86.3-5.3 6-16.3 15.9-32.3 15.4-4.1-.1-8.2-.8-12.2-1.9L366 427c-5.7-1.7-15.5 4-16.9 9.8l-9.3 38.5c-1 4.2-2.6 8.2-4.6 11.8-7.7 14-21.6 18.5-29.4 20.1-16.2 3.1-32.8 4.8-49.8 4.8s-33.6-1.7-49.8-4.8c-7.9-1.5-21.8-6.1-29.4-20.1-2-3.7-3.6-7.6-4.6-11.8l-9.3-38.5c-1.4-5.8-11.2-11.5-16.9-9.8l-38 11.2c-4 1.2-8.1 1.8-12.2 1.9-16.1.5-27-9.4-32.3-15.4-22-25.1-39.1-54.6-49.9-86.3-2.6-7.6-5.6-21.8 2.7-35.4 2.2-3.6 4.9-7 8-10L53 265.7c4.2-4 4.2-15.5 0-19.5l-28.8-27.3c-3.1-3-5.8-6.4-8-10-8.2-13.6-5.2-27.8-2.6-35.3 10.8-31.7 27.8-61.1 49.9-86.3 5.3-6 16.3-15.9 32.3-15.4 4.1.1 8.2.8 12.2 1.9L146 85c5.7 1.7 15.5-4 16.9-9.8l9.3-38.5c1-4.2 2.6-8.2 4.6-11.8 7.7-14 21.6-18.5 29.4-20.1C222.4 1.7 239 0 256 0m-37.9 51.4-8.5 35.1c-7.8 32.3-45.3 53.9-77.2 44.6l-34.5-10.2c-16.5 19.3-29.5 41.7-38 65.7l26.2 24.9c24 22.8 24 66.2 0 89l-26.2 24.9c8.5 24 21.5 46.4 38 65.7l34.6-10.2c31.8-9.4 69.4 12.3 77.2 44.6l8.5 35.1c24.6 4.5 51.3 4.5 75.9 0l8.5-35.1c7.8-32.3 45.3-53.9 77.2-44.6l34.6 10.2c16.5-19.3 29.5-41.7 38-65.7l-26.2-24.9c-24-22.8-24-66.2 0-89l26.2-24.9c-8.5-24-21.5-46.4-38-65.7l-34.6 10.2c-31.8 9.4-69.4-12.3-77.2-44.6l-8.5-35.1c-24.6-4.5-51.3-4.5-75.9 0zM208 256a48 48 0 1 0 96 0 48 48 0 1 0-96 0m48 96a96 96 0 1 1 0-192 96 96 0 1 1 0 192"/></svg>'};let snippetVariables={site_name:"Jerimiah Smiggins",home_page:loggedIn?"home":"index",username:loggedIn?username:""};let snippetProcessing={input_enter:p_inputEnter,password_toggle:p_passwordToggle,timeline_switch:p_tlSwitch,timeline_more:p_tlMore,login:p_login,signup:p_signup,logout:p_logout,home:p_home,user:p_user};let snippets={};function getSnippet(snippet,extraVariables){let s=snippets[snippet];let content=s.content;for(const i of Object.keys(icons)){content=content.replaceAll(`@{${i}}`,icons[i])}for(const i of s.variables){let replacementValue="";if(i in snippetVariables){replacementValue=snippetVariables[i]}else{console.log(`Unknown snippet variable "${i}"`)}content=content.replaceAll(`@{${i}}`,replacementValue)}if(extraVariables){for(const i of Object.keys(extraVariables)){content=content.replaceAll(`@{${i}}`,extraVariables[i])}}let element=document.createElement("div");element.innerHTML=content;for(const i of s.processing){if(i in snippetProcessing){snippetProcessing[i](element)}else{console.log(`Unknown snippet process "${i}"`)}}generateInternalLinks(element);return element}function p_inputEnter(element){for(const el of element.querySelectorAll("[data-enter-submit]")){el.onkeydown=inputEnterEvent}}function p_passwordToggle(element){for(const el of element.querySelectorAll("[data-password-toggle]")){el.onclick=togglePasswords}}for(const snippet of document.querySelectorAll("[data-snippet]")){snippets[snippet.dataset.snippet]={variables:((_a=snippet.dataset.snippetVariables)===null||_a===void 0?void 0:_a.split(",").filter(a=>a))||[],processing:((_b=snippet.dataset.snippetProcessing)===null||_b===void 0?void 0:_b.split(",").filter(a=>a))||[],content:snippet.innerHTML};snippet.remove()}(_c=document.getElementById("snippets"))===null||_c===void 0?void 0:_c.remove();let currentTl;let tlElement;let timelines={};let tlCache={};let offset=null;const LOADING_HTML='<i class="timeline-status">Loading...</i>';const TL_CACHE_TTL=60*60*1e3;function hookTimeline(element,tls,activeTimeline){timelines=tls;currentTl=timelines[activeTimeline];tlElement=element;reloadTimeline()}function reloadTimeline(){tlElement.innerHTML=LOADING_HTML;fetch(currentTl.url,{headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{renderTimeline(json);if(currentTl.timelineCallback){currentTl.timelineCallback(json)}}).catch(err=>{createToast("Something went wrong!",String(err));throw err})}function loadMorePosts(){let more=document.getElementById("timeline-more");let currentTimeline=currentTl;if(more){more.hidden=true}tlElement.insertAdjacentHTML("beforeend",LOADING_HTML);fetch(`${currentTl.url}?offset=${offset}`,{headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(currentTl.url!==currentTimeline.url){console.log("timeline switched, discarding request");return}renderTimeline(json)}).catch(err=>{createToast("Something went wrong!",String(err));if(more){more.hidden=false}clearTimelineStatuses();throw err})}function clearTimelineStatuses(){let statuses=tlElement.querySelectorAll(".timeline-status");for(const el of statuses){el.remove()}}function renderTimeline(json){if(!json.success){createToast("Something went wrong!");console.log(json);return}clearTimelineStatuses();let frag=document.createDocumentFragment();let more=document.getElementById("timeline-more");if(more){if(json.end){more.hidden=true}else{more.hidden=false}}for(const post of json.posts){frag.append(getPost(post))}tlElement.append(frag)}function switchTimeline(e){var _a;let el=e.target;if(!el){return}if(el.dataset.timelineId&&el.dataset.timelineId in timelines&&timelines[el.dataset.timelineId].url!==currentTl.url){currentTl=timelines[el.dataset.timelineId];reloadTimeline()}for(const el of document.querySelectorAll("[data-timeline-active]")){delete el.dataset.timelineActive}(_a=document.getElementById("timeline-more"))===null||_a===void 0?void 0:_a.setAttribute("hidden","");e.target.dataset.timelineActive=""}function p_tlMore(element){let el=element.querySelector('[id="timeline-more"]');if(el){el.addEventListener("click",()=>{el.setAttribute("hidden","");loadMorePosts()})}}function p_tlSwitch(element){let carouselItems=element.querySelectorAll("[data-timeline-id]");for(const i of carouselItems){i.addEventListener("click",switchTimeline)}}function createToast(title,content,timeout){var _a;let toast=getSnippet("toast",{title:title,content:content||""});(_a=document.getElementById("toasts"))===null||_a===void 0?void 0:_a.append(toast);setTimeout(()=>toast.remove(),timeout||3e3)}function inputEnterEvent(e){if(e.key!=="Enter"){return}let el=e.currentTarget;let eventQuery=e.ctrlKey&&el.dataset.enterSubmit||el.dataset.enterNext||el.dataset.enterSubmit;if(!eventQuery||eventQuery==="!avoid"){return}let newElement=document.querySelector(eventQuery);if(!newElement){return}newElement.focus();if(newElement.nodeName==="BUTTON"){newElement.click()}e.preventDefault()}function togglePasswords(){let toText=document.querySelectorAll('input[type="password"]');let toPassword=document.querySelectorAll("input[data-toggle-password]");for(const el of toText){el.type="text";el.dataset.togglePassword=""}for(const el of toPassword){el.type="password";delete el.dataset.togglePassword}}function sha256(ascii){function rightRotate(value,amount){return value>>>amount|value<<32-amount}let maxWord=Math.pow(2,32);let result="";let words=[];let asciiBitLength=ascii["length"]*8;let hash=[];let k=[];let primeCounter=k["length"];let isComposite={};for(let candidate=2;primeCounter<64;candidate++){if(!isComposite[candidate]){for(let i=0;i<313;i+=candidate){isComposite[i]=candidate}hash[primeCounter]=Math.pow(candidate,.5)*maxWord|0;k[primeCounter++]=Math.pow(candidate,1/3)*maxWord|0}}ascii+="";while(ascii["length"]%64-56)ascii+="\0";for(let i=0;i<ascii["length"];i++){let j=ascii.charCodeAt(i);if(j>>8)return"";words[i>>2]|=j<<(3-i)%4*8}words[words.length]=asciiBitLength/maxWord|0;words[words.length]=asciiBitLength;for(let j=0;j<words.length;){let w=words.slice(j,j+=16);let oldHash=hash;hash=hash.slice(0,8);for(let i=0;i<64;i++){let w15=w[i-15];let w2=w[i-2];let a=hash[0];let e=hash[4];let temp1=hash[7]+(rightRotate(e,6)^rightRotate(e,11)^rightRotate(e,25))+(e&hash[5]^~e&hash[6])+k[i]+(w[i]=i<16?w[i]:w[i-16]+(rightRotate(w15,7)^rightRotate(w15,18)^w15>>>3)+w[i-7]+(rightRotate(w2,17)^rightRotate(w2,19)^w2>>>10)|0);let temp2=(rightRotate(a,2)^rightRotate(a,13)^rightRotate(a,22))+(a&hash[1]^a&hash[2]^hash[1]&hash[2]);hash=[temp1+temp2|0].concat(hash);hash[4]=hash[4]+temp1|0}for(let i=0;i<8;i++){hash[i]=hash[i]+oldHash[i]|0}}for(let i=0;i<8;i++){for(let j=3;j+1;j--){let b=hash[i]>>j*8&255;result+=(b<16?0:"")+b.toString(16)}}return result}function escapeHTML(str){if(str===undefined){return"⚠️"}return str.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll('"',"&quot;").replaceAll("`","&#96;")}function getTimestamp(timestamp,raw=false){let difference=Math.round((new Date).getTime()/1e3-timestamp);let future=difference<0;let complexTimestamps=!!localStorage.getItem("complex-timestamps");if(future){difference=-difference}let output="?";if(difference<60){output=`${difference}s`}else if(difference<60*60){output=`${Math.floor(difference/60)}m`+(complexTimestamps?`${difference%60}s`:"")}else if(difference<60*60*24){output=`${Math.floor(difference/60/60)}h`+(complexTimestamps?`${Math.floor(difference/60)%60}m`:"")}else if(difference<60*60*24*365){output=`${Math.floor(difference/60/60/24)}d`+(complexTimestamps?`${Math.floor(difference/60/60)%24}h`:"")}else if(!isNaN(timestamp)){output=`${Math.floor(difference/60/60/24/365)}y`+(complexTimestamps?`${Math.floor(difference/60/60/24)%365}d`:"")}if(future){output="in "+output}if(raw){return output}return`<span data-timestamp="${timestamp}">${output}</span>`}function updateTimestamps(){let timestamps=document.querySelectorAll("[data-timestamp]");for(const i of timestamps){let newTime=getTimestamp(+(i.dataset.timestamp||NaN),true);if(newTime!==i.innerText){i.innerText=newTime}}}function errorCodeStrings(code,context,data){switch(code){case"BAD_PASSWORD":return["Invalid password."];case"BAD_USERNAME":switch(context){case"login":return["Invalid username.",`User '${data===null||data===void 0?void 0:data.username}' does not exist.`];default:return["Invalid username."]}case"INVALID_OTP":return["Invalid invite code.","Make sure your invite code is correct and try again."];case"NOT_AUTHENTICATED":return["Not authenticated."];case"POLL_SINGLE_OPTION":return["Invalid poll.","Must have more than one option."];case"RATELIMIT":return["Ratelimited.","Try again in a few seconds."];case"USERNAME_USED":switch(context){case"login":return["Username in use.",`User '${data===null||data===void 0?void 0:data.username}' already exists.`];default:return["Username in use."]}}return[code||"Something went wrong!"]}function getPost(post){let postContent=escapeHTML(post.content);offset=post.id;if(post.content_warning){postContent=`<details class="content-warning"><summary><div>${escapeHTML(post.content_warning)}<div class="content-warning-stats"> (${post.content.length} char${post.content.length===1?"":"s"})</div></div></summary>${postContent}</details>`}let el=getSnippet("post",{timestamp:getTimestamp(post.timestamp),username:post.user.username,display_name:escapeHTML(post.user.display_name),content:postContent});if(post.private){el.dataset.privatePost=""}return el}setInterval(updateTimestamps,1e3);function p_home(element){var _a;hookTimeline(element.querySelector('[id="timeline-posts"]'),{following:{url:"/api/timeline/following",prependPosts:true},global:{url:"/api/timeline/global",prependPosts:true}},"global");(_a=element.querySelector("#post"))===null||_a===void 0?void 0:_a.addEventListener("click",homeCreatePost)}function homeCreatePost(e){var _a;let cwElement=document.getElementById("post-cw");let contentElement=document.getElementById("post-content");let privatePostElement=document.getElementById("post-private");if(!cwElement||!contentElement||!privatePostElement){return}let cw=cwElement.value;let content=contentElement.value;let privatePost=privatePostElement.checked;if(!content){contentElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");createPost(content,cw||null,privatePost,success=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");contentElement.focus();if(success){cwElement.value="";contentElement.value=""}})}function createPost(content,cw,followersOnly,callback){fetch("/api/post",{method:"POST",body:JSON.stringify({content:content,cw:cw,private:followersOnly,poll:[]}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){if(currentTl.prependPosts){tlElement.prepend(getPost(json.post))}}else{createToast(...errorCodeStrings(json.reason,"post"))}callback&&callback(json.success)}).catch(err=>{callback&&callback(false);createToast("Something went wrong!",String(err));throw err})}function loginSubmitEvent(e){var _a;let usernameElement=document.getElementById("username");let passwordElement=document.getElementById("password");if(!usernameElement||!passwordElement){return}let username=usernameElement.value;let password=passwordElement.value;if(!username){usernameElement.focus();return}else if(!password){passwordElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user/login",{method:"POST",body:JSON.stringify({username:username,password:sha256(password)}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){document.cookie=`token=${json.token};Path=/;SameSite=Lax;Expires=${new Date((new Date).getTime()+356*24*60*60*1e3).toUTCString()}`;location.href="/"}else{(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast(...errorCodeStrings(json.reason,"login"))}}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function p_login(element){element.querySelector("#submit").addEventListener("click",loginSubmitEvent)}function p_logout(element){document.cookie="token=;Path=/;Expires=Thu, 01 Jan 1970 00:00:01 GMT;";location.href="/"}function signupSubmitEvent(e){var _a;let usernameElement=document.getElementById("username");let passwordElement=document.getElementById("password");let confirmElement=document.getElementById("confirm");let otpElement=document.getElementById("otp");if(!usernameElement||!passwordElement||!confirmElement||!otpElement){return}let username=usernameElement.value;let password=passwordElement.value;let confirm=confirmElement.value;let otp=null;if(!otpElement.hidden){otp=otpElement.value}if(!otpElement.hidden&&!otp){otpElement.focus();return}else if(!username){usernameElement.focus();return}else if(!password){passwordElement.focus();return}else if(password!==confirm){confirmElement.focus();createToast("Passwords don't match.");return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user/signup",{method:"POST",body:JSON.stringify({username:username,password:sha256(password),otp:otp}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){document.cookie=`token=${json.token};Path=/;SameSite=Lax;Expires=${new Date((new Date).getTime()+356*24*60*60*1e3).toUTCString()}`;location.href="/"}else{(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast(...errorCodeStrings(json.reason,"signup"))}}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function p_signup(element){var _a;(_a=element.querySelector("#submit"))===null||_a===void 0?void 0:_a.addEventListener("click",signupSubmitEvent)}const colorRegex=/^#[0-9a-f]{6}$/;function getUsernameFromPath(path){return(path||location.pathname).toLowerCase().split("/").filter(Boolean)[1]}function p_user(element){var _a,_b;let userUsername=getUsernameFromPath();let tlId=`user_${userUsername}`;(_a=element.querySelector("#follow"))===null||_a===void 0?void 0:_a.addEventListener("click",toggleFollow);(_b=element.querySelector("#block"))===null||_b===void 0?void 0:_b.addEventListener("click",toggleBlock);hookTimeline(element.querySelector('[id="timeline-posts"]'),{[tlId]:{url:`/api/timeline/user/${userUsername}`,prependPosts:username===userUsername,timelineCallback:userUpdateStats}},tlId)}function userUpdateStats(json){var _a;if(!json.success&&json.reason==="BAD_USERNAME"){let tlContainer=document.getElementById("timeline-posts");if(tlContainer){tlContainer.innerHTML=`<i class="timeline-status">User '${escapeHTML(getUsernameFromPath())}' does not exist.</i>`}}if(!json.success||!json.extraData){return}if(username!==getUsernameFromPath()){(_a=document.getElementById("user-interactions"))===null||_a===void 0?void 0:_a.removeAttribute("hidden");let followElement=document.getElementById("follow");let blockElement=document.getElementById("block");if(followElement){if(json.extraData.following){followElement.innerText="Unfollow";followElement.dataset.unfollow=""}else{followElement.innerText="Follow";delete followElement.dataset.unfollow}}if(blockElement){if(json.extraData.blocking){blockElement.innerText="Unblock";blockElement.dataset.unblock=""}else{blockElement.innerText="Block";delete blockElement.dataset.unblock}}}let displayNameElement=document.getElementById("display-name");let displayName=json.extraData.display_name;if(displayNameElement&&displayName){displayNameElement.innerText=displayName}let bannerElement=document.getElementById("user-banner");if(bannerElement){let colorOne=json.extraData.color_one;let colorTwo=json.extraData.color_two;if(colorOne&&colorRegex.test(colorOne)){bannerElement.style.setProperty("--color-one",colorOne)}if(colorTwo&&colorRegex.test(colorTwo)){bannerElement.style.setProperty("--color-two",colorTwo)}}let followingElement=document.getElementById("following");let followersElement=document.getElementById("followers");if(followingElement&&json.extraData.num_following){followingElement.innerText=json.extraData.num_following}if(followersElement&&json.extraData.num_followers){followersElement.innerText=json.extraData.num_followers}}function toggleFollow(e){let followButton=e.target;if(!followButton){return}let unfollow=followButton.dataset.unfollow!==undefined;followButton.disabled=true;fetch("/api/user/follow",{method:unfollow?"DELETE":"POST",body:JSON.stringify({username:getUsernameFromPath()}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){if(unfollow){followButton.innerText="Follow";delete followButton.dataset.unfollow}else if(json.pending){followButton.innerText="Pending";followButton.dataset.unfollow=""}else{followButton.innerText="Unfollow";followButton.dataset.unfollow=""}}else{createToast(...errorCodeStrings(json.reason,"user"))}followButton.disabled=false}).catch(err=>{followButton.disabled=false;createToast("Something went wrong!",String(err));throw err})}function toggleBlock(e){let blockButton=e.target;if(!blockButton){return}let unblock=blockButton.dataset.unblock!==undefined;blockButton.disabled=true;fetch("/api/user/block",{method:unblock?"DELETE":"POST",body:JSON.stringify({username:getUsernameFromPath()}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){console.log(json,unblock,blockButton);if(unblock){blockButton.innerText="Block";delete blockButton.dataset.unblock}else{blockButton.innerText="Unblock";blockButton.dataset.unblock="";let followButton=document.getElementById("follow");if(followButton&&followButton.dataset.unfollow!==undefined){delete followButton.dataset.unfollow;followButton.innerText="Follow"}}}else{createToast(...errorCodeStrings(json.reason,"user"))}blockButton.disabled=false}).catch(err=>{blockButton.disabled=false;createToast("Something went wrong!",String(err));throw err})}