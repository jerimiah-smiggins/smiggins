"use strict";const keybinds={n:()=>{createPostModal()}};function keyHandler(e){let el=e.target;if(el&&(el.tagName==="INPUT"||el.tagName==="TEXTAREA")){return}if(e.key in keybinds){keybinds[e.key](e);e.preventDefault()}}onkeydown=keyHandler;const RE_TLDs="aaa|aarp|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|actor|ad|ads|adult|ae|aeg|aero|aetna|af|afl|africa|ag|agakhan|agency|ai|aig|airbus|airforce|airtel|akdn|al|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|amazon|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|casa|case|cash|casino|cat|catering|catholic|cba|cbn|cbre|cc|cd|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|charity|chase|chat|cheap|chintai|christmas|chrome|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cpa|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dog|domains|dot|download|drive|dtv|dubai|dunlop|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|ericsson|erni|es|esq|estate|et|eu|eurovision|eus|events|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontier|ftr|fujitsu|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gay|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|horse|hospital|host|hosting|hot|hotels|hotmail|house|how|hr|hsbc|ht|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|inc|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|intuit|investments|io|ipiranga|iq|ir|irish|is|ismaili|ist|istanbul|it|itau|itv|jaguar|java|jcb|je|jeep|jetzt|jewelry|jio|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerryproperties|kfh|kg|kh|ki|kia|kids|kim|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|link|live|living|lk|llc|llp|loan|loans|locker|locus|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|merckmsd|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|moda|moe|moi|mom|monash|money|monster|mormon|mortgage|moscow|moto|motorcycles|mov|movie|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|music|mv|mw|mx|my|mz|na|nab|nagoya|name|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|office|okinawa|olayan|olayangroup|ollo|om|omega|one|ong|onl|online|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|paris|pars|partners|parts|party|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|radio|re|read|realestate|realtor|realty|recipes|red|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|ril|rio|rip|ro|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|sas|save|saxo|sb|sbi|sbs|sc|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|search|seat|secure|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shell|shia|shiksha|shoes|shop|shopping|shouji|show|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|spa|space|sport|spot|sr|srl|ss|st|stada|staples|star|statebank|statefarm|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|viva|vivo|vlaanderen|vn|vodka|volvo|vote|voting|voto|voyage|vu|wales|walmart|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4dbrk0ce|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cckwcxetd|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq480n2rg|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbah1a3hjkrd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgbcpq6gpa1a|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--otu796d|xn--p1acf|xn--p1ai|xn--pgbs0dh|xn--pssy2u|xn--q7ce6a|xn--q9jyb4c|xn--qcka1pmc|xn--qxa6a|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zm|zone|zuerich|zw";const RE_IPs="25[0-5]|2[0-4][0-9]|1?[0-9]{1,2}";const RE_PORTS=":(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[0-5][0-9]{4}|[1-9][0-9]{0,3})";let urlRegex=new RegExp(`(?:https?:\\/\\/)?(?:[-a-z0-9]+\\.){1,}(?:${RE_IPs}|${RE_TLDs})\\b(?:${RE_PORTS}\\b)?(?:/(?:&amp;|[-a-zA-Z0-9@:%_\\+.~#?/=&])*)?`,"g");let mentionRegex=new RegExp(`@([a-zA-Z0-9_\\-]{1,${limits.username}})\\b`,"g");let hashtagRegex=/#([a-zA-Z0-9_]{1,64})\b/g;function withinBounds(index,length,bounds){for(const i of bounds){if(i.index<=index&&i.index+i.length-1>=index||i.index<=index+length-1&&i.index+i.length-1>=index+length-1||i.index>=index&&i.index+i.length-1<=index+length-1){return true}}return false}function urlReplacements(str,repl){repl.sort((a,b)=>b.index-a.index);for(const r of repl){let linkTag=`<a href="${r.href}" ${r.hiddenLink?'class="plain-link"':""} ${r.internalIntent?`data-internal-link="${r.internalIntent}"`:'target="_blank"'}>`;str=str.slice(0,r.index)+linkTag+str.slice(r.index,r.index+r.length)+"</a>"+str.slice(r.index+r.length)}return str}function linkify(str,postID,postIsComment){let urlReplacement=[];for(const url of str.matchAll(urlRegex)){let link=url[0];if(!link.startsWith("https://")&&!link.startsWith("http://")){link="https://"+link}urlReplacement.push({index:url.index,length:url[0].length,href:unescapeHTML(link)})}for(const mention of str.matchAll(mentionRegex)){if(!withinBounds(mention.index,mention[0].length,urlReplacement)){urlReplacement.push({index:mention.index,length:mention[0].length,href:`/u/${mention[1]}/`,internalIntent:"user"})}}for(const hashtag of str.matchAll(hashtagRegex)){if(!withinBounds(hashtag.index,hashtag[0].length,urlReplacement)){urlReplacement.push({index:hashtag.index,length:hashtag[0].length,href:`/hashtag/${hashtag[1]}/`,internalIntent:"hashtag"})}}if(postID){let href=`/${postIsComment?"c":"p"}/${postID}/`;let newReplacements=[];let textIndex=0;urlReplacement.sort((a,b)=>a.index-b.index);for(const repl of urlReplacement){if(repl.index-textIndex>0){newReplacements.push({index:textIndex,length:repl.index-textIndex,href:href,internalIntent:"post",hiddenLink:true})}textIndex=repl.index+repl.length}let lastRepl=urlReplacement[urlReplacement.length-1];if(lastRepl&&lastRepl.index+lastRepl.length<str.length){newReplacements.push({index:lastRepl.index+lastRepl.length,length:str.length-lastRepl.index-lastRepl.length,href:href,internalIntent:"post",hiddenLink:true})}else if(!lastRepl){newReplacements.push({index:0,length:str.length,href:href,internalIntent:"post",hiddenLink:true})}urlReplacement.push(...newReplacements)}return urlReplacements(str,urlReplacement)}function createPostModal(type,id,isComment){var _a,_b,_c;if(document.getElementById("compose-modal")){return}let el=getSnippet("compose-modal");(_a=el.querySelector("#modal-post"))===null||_a===void 0?void 0:_a.addEventListener("click",postModalCreatePost);(_b=el.querySelector("#compose-modal"))===null||_b===void 0?void 0:_b.addEventListener("click",clearPostModalIfClicked);document.body.append(el);(_c=el.querySelector("#modal-post-content"))===null||_c===void 0?void 0:_c.focus();document.addEventListener("keydown",clearPostModalOnEscape);if(type&&id&&isComment){}}function postModalCreatePost(e){var _a;let cwElement=document.getElementById("modal-post-cw");let contentElement=document.getElementById("modal-post-content");let privatePostElement=document.getElementById("modal-post-private");if(!cwElement||!contentElement||!privatePostElement){return}let cw=cwElement.value;let content=contentElement.value;let privatePost=privatePostElement.checked;if(!content){contentElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");createPost(content,cw||null,privatePost,success=>{var _a;if(success){clearPostModal()}else{contentElement.focus();(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled")}})}function clearPostModalOnEscape(e){if(e.key==="Escape"){clearPostModal();document.removeEventListener("keydown",clearPostModalOnEscape);e.preventDefault()}}function clearPostModalIfClicked(e){var _a;if((_a=e.target)===null||_a===void 0?void 0:_a.dataset.closeModal){clearPostModal()}}function clearPostModal(){var _a;(_a=document.getElementById("compose-modal"))===null||_a===void 0?void 0:_a.remove()}const container=document.getElementById("container");function urlToIntent(path){path=normalizePath(path);if(loggedIn){switch(path){case"/home/":case"/login/":case"/signup/":history.pushState("home","","/");case"/":return"home";case"/settings/":return"settings";case"/settings/profile/":return"settings/profile";case"/settings/cosmetic/":return"settings/cosmetic";case"/settings/account/":return"settings/account";case"/settings/about/":return"settings/about";case/^\/u\/[a-z0-9_\-]+\/$/.test(path)?path:"":return"user"}}else{switch(path){case"/":return"index";case"/login/":return"login";case"/signup/":return"signup"}}switch(path){case"/logout/":return"logout";default:return"404"}}function generateInternalLinks(element){if(!element){element=container}let links=element.querySelectorAll("[data-internal-link]:not([data-link-processed])");for(const i of links){i.dataset.linkProcessed="";i.addEventListener("click",internalLinkHandler)}}function internalLinkHandler(e){if(!e.ctrlKey){let el=e.currentTarget;let newPage=el.dataset.internalLink;let newURL=el.href||null;if(newPage!==currentPage){history.pushState(newPage,"",newURL);renderPage(newPage);currentPage=newPage}e.preventDefault()}}function normalizePath(path){if(!path.endsWith("/")){path+="/"}if(!path.startsWith("/")){path="/"+path}return path.toLowerCase()}function renderPage(intent){let extraVariables={};let c;switch(intent){case"user":let u=getUsernameFromPath();c=userCache[u];extraVariables={user_username:u,display_name:c&&escapeHTML(c.display_name)||u,color_one:c&&c.color_one||"var(--background-mid)",color_two:c&&c.color_two||"var(--background-mid)",following:c&&String(c.num_following)||"0",followers:c&&String(c.num_followers)||"0"};break;case"settings/profile":let defaultBanner=window.getComputedStyle(document.documentElement).getPropertyValue("--background-mid");c=userCache[username];extraVariables={color_one:c&&c.color_one||defaultBanner,color_two:c&&c.color_two||defaultBanner,checked_if_gradient:!c||!c.color_one||!c.color_two||c.color_one===c.color_two?"":"checked",display_name:c&&escapeHTML(c.display_name)||"",bio:c&&escapeHTML(c.bio)||""}}if(tlPollingIntervalID){clearInterval(tlPollingIntervalID);tlPollingIntervalID=null}let snippet=getSnippet(`pages/${intent}`,extraVariables);container.replaceChildren(snippet);document.title=getPageTitle(intent)}function getPageTitle(intent){switch(intent){case"index":case"home":return pageTitle;case"login":return"Log In - "+pageTitle;case"signup":return"Sign Up - "+pageTitle;case"logout":return"Log Out - "+pageTitle;case"404":return"Page Not Found - "+pageTitle;case"user":return getUsernameFromPath()+" - "+pageTitle;case"settings":case"settings/profile":case"settings/cosmetic":case"settings/account":case"settings/about":return"Settings - "+pageTitle;default:return intent+" - "+pageTitle}}onpopstate=function(e){currentPage=e.state;renderPage(currentPage)};var _a,_b,_c;const icons={private:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Private post"><path d="M130.9 168.3v54.4h136v-54.4c0-37.57-30.43-68-68-68s-68 30.43-68 68m-40.8 54.4v-54.4c0-60.095 48.705-108.8 108.8-108.8s108.8 48.705 108.8 108.8v54.4h27.2c30.005 0 54.4 24.395 54.4 54.4v163.2c0 30.005-24.395 54.4-54.4 54.4h-272c-30.005 0-54.4-24.395-54.4-54.4V277.1c0-30.005 24.395-54.4 54.4-54.4zm-40.8 54.4v163.2c0 7.48 6.12 13.6 13.6 13.6h272c7.48 0 13.6-6.12 13.6-13.6V277.1c0-7.48-6.12-13.6-13.6-13.6h-272c-7.48 0-13.6 6.12-13.6 13.6"/></svg>',back:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9.8s8.8 24.8-.8 33.9L83.9 232H424c13.3 0 24 10.7 24 24s-10.7 24-24 24H83.9l132.7 126.6c9.6 9.2 9.9 24.3.8 33.9s-24.3 9.9-33.9.8l-176-168z"/></svg>',comment:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Comment"><path d="M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4 26.5 9.6 56.2 15.1 87.8 15.1 124.7 0 208-80.5 208-160S380.7 80 256 80 48 160.5 48 240c0 32 12.4 62.8 35.7 89.2 8.6 9.7 12.8 22.5 11.8 35.5-1.4 18.1-5.7 34.7-11.3 49.4 17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9q2.7-4.05 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240 0 125.1 114.6 32 256 32s256 93.1 256 208-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9-11.9 8.7-31.3 20.6-54.3 30.6-15.1 6.6-32.3 12.6-50.1 16.1-.8.2-1.6.3-2.4.5-4.4.8-8.7 1.5-13.2 1.9-.2 0-.5.1-.7.1-5.1.5-10.2.8-15.3.8-6.5 0-12.3-3.9-14.8-9.9S0 457.4 4.5 452.8c4.1-4.2 7.8-8.7 11.3-13.5q2.55-3.45 4.8-6.9c.1-.2.2-.3.3-.5z"/></svg>',quote:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Quote"><path d="M0 216C0 149.7 53.7 96 120 96h16c13.3 0 24 10.7 24 24s-10.7 24-24 24h-16c-39.8 0-72 32.2-72 72v10c5.1-1.3 10.5-2 16-2h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64zm48 72v64c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16H64c-8.8 0-16 7.2-16 16m336-16h-64c-8.8 0-16 7.2-16 16v64c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16m-128 48V216c0-66.3 53.7-120 120-120h16c13.3 0 24 10.7 24 24s-10.7 24-24 24h-16c-39.8 0-72 32.2-72 72v10c5.1-1.3 10.5-2 16-2h64c35.3 0 64 28.7 64 64v64c0 35.3-28.7 64-64 64h-64c-35.3 0-64-28.7-64-64z"/></svg>',like:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Like"><path d="m225.8 468.2-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144 39.4-7.6 79.7 1.5 111.8 24.1 9 6.4 17.4 13.8 25 22.3 4.2-4.8 8.7-9.2 13.5-13.3 3.7-3.2 7.5-6.2 11.5-9 32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9M239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20-.1-.1c-23.1-25.9-58-37.7-92-31.2-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9-34-6.5-69 5.4-92 31.2l-.1.1-.1.1-17.8 20c-.3.4-.7.7-1 1.1-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>',like_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Remove like"><path d="m47.6 300.4 180.7 168.7c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9l180.7-168.7c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141-45.6-7.6-92 7.3-124.6 39.9l-12 12-12-12c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5"/></svg>',home_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-label="Home"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1H392c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.6H32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24"/></svg>',home:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-label="Home"><path d="M303.5 5.7c-9-7.6-22.1-7.6-31.1 0l-264 224c-10.1 8.6-11.3 23.7-2.8 33.8s23.7 11.3 33.8 2.8L64 245.5V432c0 44.2 35.8 80 80 80h288c44.2 0 80-35.8 80-80V245.5l24.5 20.8c10.1 8.6 25.3 7.3 33.8-2.8s7.3-25.3-2.8-33.8zM112 432V204.8L288 55.5l176 149.3V432c0 17.7-14.3 32-32 32h-48V312c0-22.1-17.9-40-40-40H232c-22.1 0-40 17.9-40 40v152h-48c-17.7 0-32-14.3-32-32m128 32V320h96v144z"/></svg>',notifications_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Notifications"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416h384c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3c-31.2-35.2-48.5-80.5-48.5-127.6V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m45.3 493.3c12-12 18.7-28.3 18.7-45.3H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7"/></svg>',notifications:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Notifications"><path d="M224 0c-17.7 0-32 14.3-32 32v19.2C119 66 64 130.6 64 208v25.4c0 45.4-15.5 89.5-43.8 124.9L5.3 377c-5.8 7.2-6.9 17.1-2.9 25.4S14.8 416 24 416h400c9.2 0 17.6-5.3 21.6-13.6s2.9-18.2-2.9-25.4l-14.9-18.6c-28.3-35.5-43.8-79.6-43.8-125V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32m0 96c61.9 0 112 50.1 112 112v25.4c0 47.9 13.9 94.6 39.7 134.6H72.3c25.8-40 39.7-86.7 39.7-134.6V208c0-61.9 50.1-112 112-112m64 352H160c0 17 6.7 33.3 18.7 45.3S207 512 224 512s33.3-6.7 45.3-18.7S288 465 288 448"/></svg>',messages_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Messages"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>',messages:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Messages"><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>',user_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Profile"><path d="M224 256a128 128 0 1 0 0-256 128 128 0 1 0 0 256m-45.7 48C79.8 304 0 383.8 0 482.3 0 498.7 13.3 512 29.7 512h388.6c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3z"/></svg>',user:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" aria-label="Profile"><path d="M304 128a80 80 0 1 0-160 0 80 80 0 1 0 160 0m-208 0a128 128 0 1 1 256 0 128 128 0 1 1-256 0M49.3 464h349.5c-8.9-63.3-63.3-112-129-112h-91.4c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304h91.4c98.5 0 178.3 79.8 178.3 178.3 0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3"/></svg>',settings_active:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Settings"><path d="M495.9 166.6c3.2 8.7.5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4l-55.6 17.8c-8.8 2.8-18.6.3-24.5-6.8-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4c-1.1-8.4-1.7-16.9-1.7-25.5s.6-17.1 1.7-25.4l-43.3-39.4c-6.9-6.2-9.6-15.9-6.4-24.6 4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2 5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8 8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" aria-label="Settings"><path d="M256 0c17 0 33.6 1.7 49.8 4.8 7.9 1.5 21.8 6.1 29.4 20.1 2 3.7 3.6 7.6 4.6 11.8l9.3 38.5c1.4 5.8 11.2 11.5 16.9 9.8l38-11.2c4-1.2 8.1-1.8 12.2-1.9 16.1-.5 27 9.4 32.3 15.4 22.1 25.1 39.1 54.6 49.9 86.3 2.6 7.6 5.6 21.8-2.7 35.4-2.2 3.6-4.9 7-8 10L459 246.3c-4.2 4-4.2 15.5 0 19.5l28.7 27.3c3.1 3 5.8 6.4 8 10 8.2 13.6 5.2 27.8 2.7 35.4-10.8 31.7-27.8 61.1-49.9 86.3-5.3 6-16.3 15.9-32.3 15.4-4.1-.1-8.2-.8-12.2-1.9L366 427c-5.7-1.7-15.5 4-16.9 9.8l-9.3 38.5c-1 4.2-2.6 8.2-4.6 11.8-7.7 14-21.6 18.5-29.4 20.1-16.2 3.1-32.8 4.8-49.8 4.8s-33.6-1.7-49.8-4.8c-7.9-1.5-21.8-6.1-29.4-20.1-2-3.7-3.6-7.6-4.6-11.8l-9.3-38.5c-1.4-5.8-11.2-11.5-16.9-9.8l-38 11.2c-4 1.2-8.1 1.8-12.2 1.9-16.1.5-27-9.4-32.3-15.4-22-25.1-39.1-54.6-49.9-86.3-2.6-7.6-5.6-21.8 2.7-35.4 2.2-3.6 4.9-7 8-10L53 265.7c4.2-4 4.2-15.5 0-19.5l-28.8-27.3c-3.1-3-5.8-6.4-8-10-8.2-13.6-5.2-27.8-2.6-35.3 10.8-31.7 27.8-61.1 49.9-86.3 5.3-6 16.3-15.9 32.3-15.4 4.1.1 8.2.8 12.2 1.9L146 85c5.7 1.7 15.5-4 16.9-9.8l9.3-38.5c1-4.2 2.6-8.2 4.6-11.8 7.7-14 21.6-18.5 29.4-20.1C222.4 1.7 239 0 256 0m-37.9 51.4-8.5 35.1c-7.8 32.3-45.3 53.9-77.2 44.6l-34.5-10.2c-16.5 19.3-29.5 41.7-38 65.7l26.2 24.9c24 22.8 24 66.2 0 89l-26.2 24.9c8.5 24 21.5 46.4 38 65.7l34.6-10.2c31.8-9.4 69.4 12.3 77.2 44.6l8.5 35.1c24.6 4.5 51.3 4.5 75.9 0l8.5-35.1c7.8-32.3 45.3-53.9 77.2-44.6l34.6 10.2c16.5-19.3 29.5-41.7 38-65.7l-26.2-24.9c-24-22.8-24-66.2 0-89l26.2-24.9c-8.5-24-21.5-46.4-38-65.7l-34.6 10.2c-31.8 9.4-69.4-12.3-77.2-44.6l-8.5-35.1c-24.6-4.5-51.3-4.5-75.9 0zM208 256a48 48 0 1 0 96 0 48 48 0 1 0-96 0m48 96a96 96 0 1 1 0-192 96 96 0 1 1 0 192"/></svg>'};let snippetVariables={site_name:"Jerimiah Smiggins",home_page:loggedIn?"home":"index",username:loggedIn?username:"",selected_if_default_private:defaultPostPrivate?"selected":"",checked_if_default_private:defaultPostPrivate?"checked":""};let snippetProcessing={input_enter:p_inputEnter,password_toggle:p_passwordToggle,timeline_switch:p_tlSwitch,timeline_more:p_tlMore,login:p_login,signup:p_signup,logout:p_logout,home:p_home,user:p_user,post:p_post,settings_profile:p_settingsProfile,settings_cosmetic:p_settingsCosmetic,settings_account:p_settingsAccount};let snippets={};function getSnippet(snippet,extraVariables){let s=snippets[snippet];let content=s.content;for(const i of Object.keys(icons)){content=content.replaceAll(`@{icon_${i}}`,icons[i])}for(const i of s.variables){let replacementValue="";let replacementCount=0;if(typeof i==="string"){if(i in snippetVariables){replacementValue=snippetVariables[i]}else{console.log(`Unknown snippet variable "${i}"`)}}else{replacementCount=i[1];if(i[0]in snippetVariables){replacementValue=i[0]}else{console.log(`Unknown snippet variable "${i}"`)}}if(replacementCount){for(let _=0;_<replacementCount;_++){content=content.replace(`@{${typeof i==="string"?i:i[0]}}`,replacementValue)}}else{content=content.replaceAll(`@{${typeof i==="string"?i:i[0]}}`,replacementValue)}}if(extraVariables){for(const i of Object.keys(extraVariables)){if(typeof extraVariables[i]==="string"){content=content.replaceAll(`@{${i}}`,extraVariables[i])}else{for(let _=0;_<extraVariables[i][1];_++){content=content.replace(`@{${i}}`,extraVariables[i][0])}}}}let element=document.createElement("div");element.innerHTML=content;for(const i of s.processing){if(i in snippetProcessing){snippetProcessing[i](element)}else{console.log(`Unknown snippet process "${i}"`)}}generateInternalLinks(element);return element}function p_inputEnter(element){for(const el of element.querySelectorAll("[data-enter-submit]")){el.onkeydown=inputEnterEvent}}function p_passwordToggle(element){for(const el of element.querySelectorAll("[data-password-toggle]")){el.onclick=togglePasswords}}for(const snippet of document.querySelectorAll("[data-snippet]")){snippets[snippet.dataset.snippet]={variables:((_a=snippet.dataset.snippetVariables)===null||_a===void 0?void 0:_a.split(",").filter(a=>a).map(a=>{if(a.includes(":")){return[a.split(":")[0],+a.split(":")[1]]}return a}))||[],processing:((_b=snippet.dataset.snippetProcessing)===null||_b===void 0?void 0:_b.split(",").filter(a=>a))||[],content:snippet.innerHTML};snippet.remove()}(_c=document.getElementById("snippets"))===null||_c===void 0?void 0:_c.remove();let themeMedia=matchMedia("(prefers-color-scheme: light)");let _themeLs=localStorage.getItem("smiggins-theme");let theme=_themeLs==="light"||_themeLs==="dark"?_themeLs:"system";function setTheme(th){switch(th){case"system":localStorage.removeItem("smiggins-theme");theme="system";updateTheme(themeMedia.matches);break;case"light":localStorage.setItem("smiggins-theme","light");theme="light";updateTheme(true);break;case"dark":localStorage.setItem("smiggins-theme","dark");theme="dark";updateTheme(false);break}}function updateTheme(light){if(light){document.documentElement.dataset.light=""}else{delete document.documentElement.dataset.light}}function updateAutoTheme(){if(theme!=="system"){return}updateTheme(themeMedia.matches)}themeMedia.addEventListener("change",updateAutoTheme);updateTheme(theme==="light"||theme==="system"&&themeMedia.matches);let currentTl;let currentTlID;let tlElement;let timelines={};let tlPollingIntervalID=null;let tlPollingPendingResponse=false;let prependedPosts=0;let tlCache={};let postCache={};let userCache={};let offset={upper:null,lower:null};const LOADING_HTML='<i class="timeline-status">Loading...</i>';const TL_CACHE_TTL=60*60;const TL_POLLING_INTERVAL=1e4;function hookTimeline(element,tls,activeTimeline,fakeBodyElement){timelines=tls;tlElement=element;_setTimeline(activeTimeline,fakeBodyElement)}function reloadTimeline(ignoreCache=false,element){var _a;tlElement.innerHTML=LOADING_HTML;prependedPosts=0;let cache=tlCache[currentTlID];if(!ignoreCache&&cache&&Math.round(Date.now()/1e3)<cache.timestamp+TL_CACHE_TTL&&cache.pendingForward!==false){offset={upper:cache.upperBound,lower:cache.lowerBound};cache.posts=cache.pendingForward.reverse().concat(cache.posts);renderTimeline(cache.posts,cache.end,false,element===null||element===void 0?void 0:element.querySelector("#timeline-more"));timelinePolling(true);return}(_a=document.getElementById("timeline-more"))===null||_a===void 0?void 0:_a.setAttribute("hidden","");delete tlCache[currentTlID];offset.upper=null;offset.lower=null;fetch(currentTl.url,{headers:{Accept:"application/json"}}).then(response=>response.json()).then(renderTimelineFromAPI).catch(err=>{createToast("Something went wrong!",String(err));throw err})}function insertIntoPostCache(posts){let postIds=[];for(const post of posts){postCache[post.id]=post;postIds.push(post.id)}return postIds}function loadMorePosts(){let more=document.getElementById("timeline-more");let currentTimeline=currentTl;let currentTimelineID=currentTlID;if(more){more.hidden=true}tlElement.insertAdjacentHTML("beforeend",LOADING_HTML);fetch(`${currentTl.url}?offset=${offset.lower}`,{headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(currentTl.url!==currentTimeline.url){console.log("timeline switched, discarding request");if(json.success){(_a=tlCache[currentTimelineID])===null||_a===void 0?void 0:_a.posts.push(...insertIntoPostCache(json.posts))}return}renderTimelineFromAPI(json)}).catch(err=>{createToast("Something went wrong!",String(err));if(more){more.hidden=false}clearTimelineStatuses();throw err})}function clearTimelineStatuses(){let statuses=tlElement.querySelectorAll(".timeline-status");for(const el of statuses){el.remove()}}function renderTimelineFromAPI(json){if(currentTl.timelineCallback){currentTl.timelineCallback(json)}if(!json.success){createToast("Something went wrong!");console.log(json);return}renderTimeline(insertIntoPostCache(json.posts),json.end)}function renderTimeline(posts,end,updateCache=true,moreElementOverride){clearTimelineStatuses();let frag=document.createDocumentFragment();let more=moreElementOverride||document.getElementById("timeline-more");if(more){if(end){more.hidden=true}else{more.hidden=false}}for(const post of posts){frag.append(getPost(post))}tlElement.append(frag);if(updateCache){let c=tlCache[currentTlID];if(!c){c={timestamp:0,upperBound:null,lowerBound:null,posts:[],pendingForward:[],end:false};tlCache[currentTlID]=c}c.timestamp=Math.round(Date.now()/1e3);c.posts.push(...posts);c.lowerBound=offset.lower;c.upperBound=offset.upper;c.end=end}}function _setTimeline(timelineId,element){let c=tlCache[currentTlID];if(c){c.upperBound=offset.upper;c.lowerBound=offset.lower}currentTl=timelines[timelineId];currentTlID=timelineId;if(tlPollingIntervalID){clearInterval(tlPollingIntervalID);tlPollingIntervalID=null}if(!currentTl.disablePolling){tlPollingIntervalID=setInterval(timelinePolling,TL_POLLING_INTERVAL)}reloadTimeline(undefined,element)}function switchTimeline(e){let el=e.target;if(!el){return}if(el.dataset.timelineId&&el.dataset.timelineId in timelines&&timelines[el.dataset.timelineId].url!==currentTl.url){_setTimeline(el.dataset.timelineId)}for(const el of document.querySelectorAll("[data-timeline-active]")){delete el.dataset.timelineActive}e.target.dataset.timelineActive=""}function getPost(post,updateOffset=true){let p=postCache[post];if(!p){let el=document.createElement("div");el.innerText="Post couldn't be loaded. Oops.";return el}let postContent=linkify(escapeHTML(p.content),post);if(updateOffset&&(!offset.lower||post<offset.lower)){offset.lower=post}if(updateOffset&&(!offset.upper||post>offset.upper)){offset.upper=post}if(p.content_warning){postContent=`<details class="content-warning"${localStorage.getItem("smiggins-expand-cws")?" open":""}><summary><div>${escapeHTML(p.content_warning)} <div class="content-warning-stats">(${p.content.length} char${p.content.length===1?"":"s"})</div></div></summary>${postContent}</details>`}let el=getSnippet("post",{timestamp:getTimestamp(p.timestamp),username:p.user.username,post_interactions_hidden:localStorage.getItem("smiggins-hide-interactions")&&"hidden"||"",pc:"p",pid:String(post),comments:String(p.interactions.comments),quotes:String(p.interactions.quotes),likes:String(p.interactions.likes),liked:String(p.interactions.liked),content:[postContent,1],display_name:[escapeHTML(p.user.display_name),1]});if(p.private){el.dataset.privatePost=""}return el}function timelineShowNew(){var _a;let c=tlCache[currentTlID];if(!c){return}let posts=c.pendingForward;c.pendingForward=[];(_a=document.getElementById("timeline-show-new"))===null||_a===void 0?void 0:_a.remove();if(posts===false){reloadTimeline(true);return}c.posts=posts.reverse().concat(c.posts);let frag=document.createDocumentFragment();for(const post of posts){frag.append(getPost(post))}prependedPosts=0;for(const el of document.querySelectorAll("[data-prepended]")){el.remove()}tlElement.prepend(frag)}function timelinePolling(forceEvent=false){let currentTimeline=currentTl;let c=tlCache[currentTlID];tlPollingPendingResponse=true;if(!c||c.pendingForward===false||!offset.upper){return}if(localStorage.getItem("smiggins-auto-show-posts")){forceEvent=true}fetch(`${currentTl.url}?offset=${offset.upper}&forwards=true`).then(response=>response.json()).then(json=>{if(currentTimeline.url!==currentTl.url){console.log("timeline switched, discarding request");if(json.success){if(json.end){c.pendingForward=false}else if(c.pendingForward!==false){c.pendingForward.push(...insertIntoPostCache(json.posts).reverse())}}}if(currentTl.timelineCallback){currentTl.timelineCallback(json)}if(json.success){if(json.posts.length===0){return}if(c.pendingForward===false){return}let showNewElement=document.getElementById("timeline-show-new");if(!forceEvent&&!showNewElement&&(!json.end||c.pendingForward.length+json.posts.length-prependedPosts>0)){showNewElement=document.createElement("button");showNewElement.id="timeline-show-new";showNewElement.addEventListener("click",timelineShowNew);tlElement.prepend(showNewElement)}if(json.end){offset.upper=json.posts[0].id;c.pendingForward.push(...insertIntoPostCache(json.posts).reverse());if(showNewElement){showNewElement.innerText=`Show new posts (${c.pendingForward.length-prependedPosts})`}}else{c.pendingForward=false;if(showNewElement){showNewElement.innerText="Refresh"}}if(forceEvent){timelineShowNew()}}else{console.log("Unsuccessful timeline polling, reason "+json.reason)}tlPollingPendingResponse=false}).catch(err=>{console.log("Something went wrong polling",err);tlPollingPendingResponse=false})}function prependPostToTimeline(post){if(currentTl.prependPosts){let newButton=document.getElementById("timeline-show-new");let prependedPost=getPost(insertIntoPostCache([post])[0],false);prependedPost.dataset.prepended="";prependedPosts++;if(newButton){tlElement.prepend(newButton,prependedPost)}else{tlElement.prepend(prependedPost)}}}function postButtonClick(e){let el=e.currentTarget;if(!el){return}if(el.dataset.interactionQuote){let iq=el.dataset.interactionQuote;let isComment=iq[0]==="c";let postId=+iq.slice(1);createPostModal("quote",postId,isComment)}else if(el.dataset.interactionLike){let il=el.dataset.interactionLike;let isComment=il[0]==="c";let postId=+il.slice(1);let liked=el.dataset.liked==="true";el.setAttribute("disabled","");fetch(`/api/${isComment?"comment":"post"}/like/${postId}`,{method:liked?"DELETE":"POST",headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){let number=el.querySelector("[data-number]");if(number){number.innerText=String(+number.innerText+(-liked+.5)*2)}let c=postCache[postId];if(c){c.interactions.liked=!liked;c.interactions.likes+=(-liked+.5)*2}el.dataset.liked=String(!liked)}else{createToast(...errorCodeStrings(json.reason))}el.removeAttribute("disabled")}).catch(err=>{el.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}}function p_tlMore(element){let el=element.querySelector('[id="timeline-more"]');if(el){el.addEventListener("click",()=>{el.setAttribute("hidden","");loadMorePosts()})}}function p_tlSwitch(element){let carouselItems=element.querySelectorAll("[data-timeline-id]");for(const i of carouselItems){i.addEventListener("click",switchTimeline)}}function p_post(element){var _a,_b;(_a=element.querySelector("[data-interaction-quote]"))===null||_a===void 0?void 0:_a.addEventListener("click",postButtonClick);(_b=element.querySelector("[data-interaction-like]"))===null||_b===void 0?void 0:_b.addEventListener("click",postButtonClick)}setInterval(updateTimestamps,1e3);function createToast(title,content,timeout){var _a;let toast=getSnippet("toast",{title:title,content:content||""});(_a=document.getElementById("toasts"))===null||_a===void 0?void 0:_a.append(toast);setTimeout(()=>toast.remove(),timeout||3e3)}function inputEnterEvent(e){if(e.key!=="Enter"){return}let el=e.currentTarget;let eventQuery=e.ctrlKey&&el.dataset.enterSubmit||el.dataset.enterNext||el.dataset.enterSubmit;if(!eventQuery||eventQuery==="!avoid"){return}let newElement=document.querySelector(eventQuery);if(!newElement){return}newElement.focus();if(newElement.nodeName==="BUTTON"){newElement.click()}e.preventDefault()}function togglePasswords(e){let toText;let toPassword;let queries="";let baseElement=e.target;if(baseElement){queries=baseElement.dataset.passwordToggle||""}if(queries){toText=[];toPassword=[];for(const q of queries.split(",")){let el=document.querySelector(q.trim());if(el){if(el.type==="password"){toText.push(el)}else{toPassword.push(el)}}}}else{toText=[...document.querySelectorAll('input[type="password"]')];toPassword=[...document.querySelectorAll("input[data-toggle-password]")]}for(const el of toText){el.type="text";el.dataset.togglePassword=""}for(const el of toPassword){el.type="password";delete el.dataset.togglePassword}}function sha256(ascii){function rightRotate(value,amount){return value>>>amount|value<<32-amount}let maxWord=Math.pow(2,32);let result="";let words=[];let asciiBitLength=ascii["length"]*8;let hash=[];let k=[];let primeCounter=k["length"];let isComposite={};for(let candidate=2;primeCounter<64;candidate++){if(!isComposite[candidate]){for(let i=0;i<313;i+=candidate){isComposite[i]=candidate}hash[primeCounter]=Math.pow(candidate,.5)*maxWord|0;k[primeCounter++]=Math.pow(candidate,1/3)*maxWord|0}}ascii+="";while(ascii["length"]%64-56)ascii+="\0";for(let i=0;i<ascii["length"];i++){let j=ascii.charCodeAt(i);if(j>>8)return"";words[i>>2]|=j<<(3-i)%4*8}words[words.length]=asciiBitLength/maxWord|0;words[words.length]=asciiBitLength;for(let j=0;j<words.length;){let w=words.slice(j,j+=16);let oldHash=hash;hash=hash.slice(0,8);for(let i=0;i<64;i++){let w15=w[i-15];let w2=w[i-2];let a=hash[0];let e=hash[4];let temp1=hash[7]+(rightRotate(e,6)^rightRotate(e,11)^rightRotate(e,25))+(e&hash[5]^~e&hash[6])+k[i]+(w[i]=i<16?w[i]:w[i-16]+(rightRotate(w15,7)^rightRotate(w15,18)^w15>>>3)+w[i-7]+(rightRotate(w2,17)^rightRotate(w2,19)^w2>>>10)|0);let temp2=(rightRotate(a,2)^rightRotate(a,13)^rightRotate(a,22))+(a&hash[1]^a&hash[2]^hash[1]&hash[2]);hash=[temp1+temp2|0].concat(hash);hash[4]=hash[4]+temp1|0}for(let i=0;i<8;i++){hash[i]=hash[i]+oldHash[i]|0}}for(let i=0;i<8;i++){for(let j=3;j+1;j--){let b=hash[i]>>j*8&255;result+=(b<16?0:"")+b.toString(16)}}return result}function escapeHTML(str){if(str===undefined){return"⚠️"}return str.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll('"',"&quot;").replaceAll("`","&#96;")}function unescapeHTML(str){if(str===undefined){return"⚠️"}return str.replaceAll("&#96;","`").replaceAll("&quot;",'"').replaceAll("&lt;","<").replaceAll("&amp;","&")}function getTimestamp(timestamp,raw=false){let difference=Math.round(Date.now()/1e3-timestamp);let future=difference<0;let complexTimestamps=!!localStorage.getItem("smiggins-complex-timestamps");if(future){difference=-difference}let output="?";if(difference<60){output=`${difference}s`}else if(difference<60*60){output=`${Math.floor(difference/60)}m`+(complexTimestamps?`${difference%60}s`:"")}else if(difference<60*60*24){output=`${Math.floor(difference/60/60)}h`+(complexTimestamps?`${Math.floor(difference/60)%60}m`:"")}else if(difference<60*60*24*365){output=`${Math.floor(difference/60/60/24)}d`+(complexTimestamps?`${Math.floor(difference/60/60)%24}h`:"")}else if(!isNaN(timestamp)){output=`${Math.floor(difference/60/60/24/365)}y`+(complexTimestamps?`${Math.floor(difference/60/60/24)%365}d`:"")}if(future){output="in "+output}if(raw){return output}return`<span data-timestamp="${timestamp}">${output}</span>`}function updateTimestamps(){let timestamps=document.querySelectorAll("[data-timestamp]");for(const i of timestamps){let newTime=getTimestamp(+(i.dataset.timestamp||NaN),true);if(newTime!==i.innerText){i.innerText=newTime}}}function errorCodeStrings(code,context,data){switch(code){case"BAD_PASSWORD":return["Invalid password."];case"BAD_USERNAME":switch(context){case"login":return["Invalid username.",`User '${data===null||data===void 0?void 0:data.username}' does not exist.`];default:return["Invalid username."]}case"INVALID_OTP":return["Invalid invite code.","Make sure your invite code is correct and try again."];case"NOT_AUTHENTICATED":return["Not authenticated."];case"POLL_SINGLE_OPTION":return["Invalid poll.","Must have more than one option."];case"RATELIMIT":return["Ratelimited.","Try again in a few seconds."];case"USERNAME_USED":switch(context){case"login":return["Username in use.",`User '${data===null||data===void 0?void 0:data.username}' already exists.`];default:return["Username in use."]}case"CANT_INTERACT":return["Can't interact.","You can't interact with this user for some reason."];case"BLOCKING":return["You are blocking this person.","You need to unblock them to do this."]}return[code||"Something went wrong!"]}function setTokenCookie(token){document.cookie=`token=${token};Path=/;SameSite=Lax;Expires=${new Date(Date.now()+356*24*60*60*1e3).toUTCString()}`}function genericCheckbox(storageId){return function(e){let el=e.target;if(el){if(el.checked){localStorage.setItem(storageId,"1")}else{localStorage.removeItem(storageId)}}}}function p_home(element){var _a;hookTimeline(element.querySelector('[id="timeline-posts"]'),{following:{url:"/api/timeline/following",prependPosts:true},global:{url:"/api/timeline/global",prependPosts:true}},"global",element);(_a=element.querySelector("#post"))===null||_a===void 0?void 0:_a.addEventListener("click",homeCreatePost)}function homeCreatePost(e){var _a;let cwElement=document.getElementById("post-cw");let contentElement=document.getElementById("post-content");let privatePostElement=document.getElementById("post-private");if(!cwElement||!contentElement||!privatePostElement){return}let cw=cwElement.value;let content=contentElement.value;let privatePost=privatePostElement.checked;if(!content){contentElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");createPost(content,cw||null,privatePost,success=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");contentElement.focus();if(success){cwElement.value="";contentElement.value=""}})}function createPost(content,cw,followersOnly,callback){fetch("/api/post",{method:"POST",body:JSON.stringify({content:content,cw:cw,private:followersOnly,poll:[]}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){prependPostToTimeline(json.post)}else{createToast(...errorCodeStrings(json.reason,"post"))}callback&&callback(json.success)}).catch(err=>{callback&&callback(false);createToast("Something went wrong!",String(err));throw err})}function loginSubmitEvent(e){var _a;let usernameElement=document.getElementById("username");let passwordElement=document.getElementById("password");if(!usernameElement||!passwordElement){return}let username=usernameElement.value;let password=passwordElement.value;if(!username){usernameElement.focus();return}else if(!password){passwordElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user/login",{method:"POST",body:JSON.stringify({username:username,password:sha256(password)}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){setTokenCookie(json.token);location.href="/"}else{(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast(...errorCodeStrings(json.reason,"login",{username:username}))}}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function p_login(element){element.querySelector("#submit").addEventListener("click",loginSubmitEvent)}function p_logout(element){document.cookie="token=;Path=/;Expires=Thu, 01 Jan 1970 00:00:01 GMT;";location.href="/"}function updateBannerColors(){let bannerDisplayElement=document.getElementById("banner-example");let gradientCheckElement=document.getElementById("banner-gradient");let c1Element=document.getElementById("banner-one");let c2Element=document.getElementById("banner-two");if(!bannerDisplayElement){return}if(c1Element){bannerDisplayElement.style.setProperty("--color-one",c1Element.value);if(gradientCheckElement&&!gradientCheckElement.checked){bannerDisplayElement.style.setProperty("--color-two",c1Element.value)}}if(c2Element&&(!gradientCheckElement||gradientCheckElement.checked)){bannerDisplayElement.style.setProperty("--color-two",c2Element.value)}}function saveProfile(e){var _a;let displayNameElement=document.getElementById("display-name");let bioElement=document.getElementById("bio");let gradientCheckElement=document.getElementById("banner-gradient");let c1Element=document.getElementById("banner-one");let c2Element=document.getElementById("banner-two");let c=userCache[username];if(!displayNameElement||!bioElement||!gradientCheckElement||!c1Element||!c2Element){return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user",{method:"PATCH",body:JSON.stringify({display_name:displayNameElement.value,bio:bioElement.value,gradient:gradientCheckElement.checked,color_one:c1Element.value,color_two:c2Element.value}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){createToast("Success!","Your profile has been saved.");if(c){c.color_one=c1Element.value;c.color_two=gradientCheckElement.checked?c1Element.value:c2Element.value;c.display_name=displayNameElement.value;c.bio=bioElement.value}}else{createToast(...errorCodeStrings(json.reason))}(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled")}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function saveDefaultVisibility(){var _a;defaultPostPrivate=((_a=document.getElementById("default-private"))===null||_a===void 0?void 0:_a.value)==="true";snippetVariables.selected_if_default_private=defaultPostPrivate?"selected":"";snippetVariables.checked_if_default_private=defaultPostPrivate?"checked":"";fetch("/api/user/default_post",{method:"PATCH",body:JSON.stringify({private:defaultPostPrivate}),headers:{Accept:"application/json"}})}function settingsThemeSelection(){let themeElement=document.getElementById("theme");if(themeElement){let th=themeElement.value;if(th==="light"||th==="dark"||th==="system"){setTheme(th)}}}function changePassword(e){var _a;let currentPwElement=document.getElementById("password-current");let newPwElement=document.getElementById("password-new");let confirmPwElement=document.getElementById("password-confirm");if(!currentPwElement||!newPwElement||!confirmPwElement){return}let currentPw=currentPwElement.value;let newPw=newPwElement.value;let confirmPw=confirmPwElement.value;if(!currentPw){currentPwElement.focus();return}if(!newPw){newPwElement.focus();return}if(confirmPw!==newPw){confirmPwElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user/password",{method:"PATCH",body:JSON.stringify({current_password:sha256(currentPw),new_password:sha256(newPw)}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){setTokenCookie(json.token);createToast("Success!","Your password has been changed.");currentPwElement.value="";newPwElement.value="";confirmPwElement.value=""}else{createToast(...errorCodeStrings(json.reason))}(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled")}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function deleteAccount(e){var _a;let pwElement=document.getElementById("delete-acc-password");let confirmElement=document.getElementById("delete-acc-confirm");if(!pwElement||!confirmElement){return}let password=pwElement.value;let confirmed=confirmElement.checked;if(!password){pwElement.focus();return}if(!confirmed){confirmElement.focus();return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user",{method:"DELETE",body:JSON.stringify({password:sha256(password)}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){renderPage("logout")}else{createToast(...errorCodeStrings(json.reason));(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled")}}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function p_settingsProfile(element){fetch("/api/user").then(response=>response.json()).then(json=>{var _a,_b,_c;if(json.success){let displayNameElement=element.querySelector("#display-name");let bioElement=element.querySelector("#bio");let gradientCheckElement=element.querySelector("#banner-gradient");let c1Element=element.querySelector("#banner-one");let c2Element=element.querySelector("#banner-two");if(displayNameElement){displayNameElement.value=json.display_name}if(bioElement){bioElement.value=json.bio}if(gradientCheckElement){gradientCheckElement.checked=json.gradient}if(c1Element){c1Element.value=json.color_one;c1Element.addEventListener("input",updateBannerColors)}if(c2Element){c2Element.value=json.color_two;c2Element.addEventListener("input",updateBannerColors)}(_a=element.querySelector("#profile-save"))===null||_a===void 0?void 0:_a.addEventListener("click",saveProfile);(_b=element.querySelector("#default-private"))===null||_b===void 0?void 0:_b.addEventListener("input",saveDefaultVisibility);(_c=element.querySelector("#banner-gradient"))===null||_c===void 0?void 0:_c.addEventListener("input",updateBannerColors);let c=userCache[username];if(c){c.color_one=json.color_one;c.color_two=json.gradient?json.color_two:json.color_one;c.display_name=json.display_name;c.bio=json.bio}updateBannerColors();for(const el of element.querySelectorAll("[data-disabled-while-loading]")){el.removeAttribute("disabled")}}else{createToast(...errorCodeStrings(json.reason))}}).catch(err=>{createToast("Something went wrong!",String(err));throw err})}function p_settingsCosmetic(element){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;(_a=element.querySelector(`#theme > option[value="${theme}"]`))===null||_a===void 0?void 0:_a.setAttribute("selected","");if(localStorage.getItem("smiggins-complex-timestamps")){(_b=element.querySelector("#complex-timestamps"))===null||_b===void 0?void 0:_b.setAttribute("checked","")}if(localStorage.getItem("smiggins-expand-cws")){(_c=element.querySelector("#expand-cws"))===null||_c===void 0?void 0:_c.setAttribute("checked","")}if(localStorage.getItem("smiggins-hide-interactions")){(_d=element.querySelector("#hide-interactions"))===null||_d===void 0?void 0:_d.setAttribute("checked","")}if(localStorage.getItem("smiggins-auto-show-posts")){(_e=element.querySelector("#auto-show"))===null||_e===void 0?void 0:_e.setAttribute("checked","")}(_f=element.querySelector("#theme"))===null||_f===void 0?void 0:_f.addEventListener("change",settingsThemeSelection);(_g=element.querySelector("#complex-timestamps"))===null||_g===void 0?void 0:_g.addEventListener("change",genericCheckbox("smiggins-complex-timestamps"));(_h=element.querySelector("#expand-cws"))===null||_h===void 0?void 0:_h.addEventListener("change",genericCheckbox("smiggins-expand-cws"));(_j=element.querySelector("#hide-interactions"))===null||_j===void 0?void 0:_j.addEventListener("change",genericCheckbox("smiggins-hide-interactions"));(_k=element.querySelector("#auto-show"))===null||_k===void 0?void 0:_k.addEventListener("change",genericCheckbox("smiggins-auto-show-posts"))}function p_settingsAccount(element){var _a,_b;(_a=element.querySelector("#password-set"))===null||_a===void 0?void 0:_a.addEventListener("click",changePassword);(_b=element.querySelector("#delete-acc"))===null||_b===void 0?void 0:_b.addEventListener("click",deleteAccount)}function signupSubmitEvent(e){var _a;let usernameElement=document.getElementById("username");let passwordElement=document.getElementById("password");let confirmElement=document.getElementById("confirm");let otpElement=document.getElementById("otp");if(!usernameElement||!passwordElement||!confirmElement){return}let username=usernameElement.value;let password=passwordElement.value;let confirm=confirmElement.value;let otp=null;if(otpElement){otp=otpElement.value}if(otpElement&&!otp){otpElement.focus();return}else if(!username){usernameElement.focus();return}else if(!password){passwordElement.focus();return}else if(password!==confirm){confirmElement.focus();createToast("Passwords don't match.");return}(_a=e.target)===null||_a===void 0?void 0:_a.setAttribute("disabled","");fetch("/api/user/signup",{method:"POST",body:JSON.stringify({username:username,password:sha256(password),otp:otp}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{var _a;if(json.success){setTokenCookie(json.token);location.href="/"}else{(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast(...errorCodeStrings(json.reason,"signup"))}}).catch(err=>{var _a;(_a=e.target)===null||_a===void 0?void 0:_a.removeAttribute("disabled");createToast("Something went wrong!",String(err));throw err})}function p_signup(element){var _a;(_a=element.querySelector("#submit"))===null||_a===void 0?void 0:_a.addEventListener("click",signupSubmitEvent)}const colorRegex=/^#[0-9a-f]{6}$/;function getUsernameFromPath(path){return(path||location.pathname).toLowerCase().split("/").filter(Boolean)[1]}function p_user(element){var _a,_b;let userUsername=getUsernameFromPath();let tlId=`user_${userUsername}`;(_a=element.querySelector("#follow"))===null||_a===void 0?void 0:_a.addEventListener("click",toggleFollow);(_b=element.querySelector("#block"))===null||_b===void 0?void 0:_b.addEventListener("click",toggleBlock);hookTimeline(element.querySelector('[id="timeline-posts"]'),{[tlId]:{url:`/api/timeline/user/${userUsername}`,prependPosts:username===userUsername,timelineCallback:userUpdateStats}},tlId,element)}function userUpdateStats(json){var _a;let userUsername=getUsernameFromPath();let c=userCache[userUsername];if(!json.success&&json.reason==="BAD_USERNAME"){let tlContainer=document.getElementById("timeline-posts");if(tlContainer){tlContainer.innerHTML=`<i class="timeline-status">User '${escapeHTML(userUsername)}' does not exist.</i>`}}if(!json.success||!json.extraData){return}if(c){c.display_name=json.extraData.display_name||c.display_name;c.color_one=json.extraData.color_one||c.color_one;c.color_two=json.extraData.color_two||c.color_two;c.following=json.extraData.following||c.following;c.blocking=json.extraData.blocking||c.blocking;c.num_following=json.extraData.num_following||c.num_following;c.num_followers=json.extraData.num_followers||c.num_followers}else{c={display_name:json.extraData.display_name||username,bio:"",color_one:json.extraData.color_one||"var(--background-mid)",color_two:json.extraData.color_two||"var(--background-mid)",following:json.extraData.following||false,blocking:json.extraData.blocking||false,num_following:json.extraData.num_following||0,num_followers:json.extraData.num_followers||0};userCache[userUsername]=c}if(username!==userUsername){(_a=document.getElementById("user-interactions"))===null||_a===void 0?void 0:_a.removeAttribute("hidden");let followElement=document.getElementById("follow");let blockElement=document.getElementById("block");if(followElement){if(json.extraData.following){followElement.innerText="Unfollow";followElement.dataset.unfollow=""}else{followElement.innerText="Follow";delete followElement.dataset.unfollow}}if(blockElement){if(json.extraData.blocking){blockElement.innerText="Unblock";blockElement.dataset.unblock=""}else{blockElement.innerText="Block";delete blockElement.dataset.unblock}}}let displayNameElement=document.getElementById("display-name");let displayName=json.extraData.display_name;if(displayName){document.title=`${displayName} - ${pageTitle}`;if(displayNameElement){displayNameElement.innerText=displayName}}let bannerElement=document.getElementById("user-banner");if(bannerElement){let colorOne=json.extraData.color_one;let colorTwo=json.extraData.color_two;if(colorOne&&colorRegex.test(colorOne)){bannerElement.style.setProperty("--color-one",colorOne)}if(colorTwo&&colorRegex.test(colorTwo)){bannerElement.style.setProperty("--color-two",colorTwo)}}let followingElement=document.getElementById("following");let followersElement=document.getElementById("followers");if(followingElement&&json.extraData.num_following){followingElement.innerText=json.extraData.num_following}if(followersElement&&json.extraData.num_followers){followersElement.innerText=json.extraData.num_followers}}function toggleFollow(e){let followButton=e.target;if(!followButton){return}let unfollow=followButton.dataset.unfollow!==undefined;followButton.disabled=true;fetch("/api/user/follow",{method:unfollow?"DELETE":"POST",body:JSON.stringify({username:getUsernameFromPath()}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){if(unfollow){followButton.innerText="Follow";delete followButton.dataset.unfollow}else if(json.pending){followButton.innerText="Pending";followButton.dataset.unfollow=""}else{followButton.innerText="Unfollow";followButton.dataset.unfollow=""}}else{createToast(...errorCodeStrings(json.reason,"user"))}followButton.disabled=false}).catch(err=>{followButton.disabled=false;createToast("Something went wrong!",String(err));throw err})}function toggleBlock(e){let blockButton=e.target;if(!blockButton){return}let unblock=blockButton.dataset.unblock!==undefined;blockButton.disabled=true;fetch("/api/user/block",{method:unblock?"DELETE":"POST",body:JSON.stringify({username:getUsernameFromPath()}),headers:{Accept:"application/json"}}).then(response=>response.json()).then(json=>{if(json.success){if(unblock){blockButton.innerText="Block";delete blockButton.dataset.unblock}else{blockButton.innerText="Unblock";blockButton.dataset.unblock="";let followButton=document.getElementById("follow");if(followButton&&followButton.dataset.unfollow!==undefined){delete followButton.dataset.unfollow;followButton.innerText="Follow"}}}else{createToast(...errorCodeStrings(json.reason,"user"))}blockButton.disabled=false}).catch(err=>{blockButton.disabled=false;createToast("Something went wrong!",String(err));throw err})}