# yaml-language-server: $schema=docs.schema.json

post:
  description: "The format for a post. Not a real API endpoint."
  id: 0x00
  response:
  - { type: uint32, name: "Post ID" }
  - { type: uint64, name: "Timestamp" }

  - { type: bool7, name: "Private" }
  - { type: bool6, name: "Is comment", id: is_comment }
  - { type: bool5, name: "Is quote" }
  - { type: bool4, name: "Quote is visible", id: quote_visible }
  - { type: bool3, name: "Liked" }
  - { type: bool2, name: "Quote is private" }
  - { type: bool1, name: "Quote is comment", id: quote_is_comment }
  - { type: bool0, name: "Has poll", id: has_poll }

  - { type: bool7, name: "Edited" }
  - { type: bool6, name: "Quote edited" }
  - { type: bool5, name: "Quote has poll" }
  - { type: bool4, name: "Quote has quote" }

  - { type: uint32, name: "Comment parent ID", condition: is_comment }

  - { type: floatint, name: "Likes" }
  - { type: floatint, name: "Quotes" }
  - { type: floatint, name: "Comments" }

  - { type: str16, name: "Content" }
  - { type: str8, name: "Content warning" }
  - { type: str8, name: "Creator username" }
  - { type: str8, name: "Creator display name" }
  - { type: str8, name: "Creator pronouns" }
  - { type: hex3, name: "Creator banner color 1" }
  - { type: hex3, name: "Creator banner color 2" }

  - { type: floatint, name: "Total votes", condition: has_poll }
  - { type: uint8, name: "Poll options", id: poll_count, condition: has_poll }
  - { type: str8, name: "Poll option", loop: poll_count, condition: has_poll }
  - { type: uint16, name: "Percentage + 1 decimal (0.0-100.0)", loop: poll_count, condition: has_poll }
  - { type: bool7, name: "Is voted for by self", loop: poll_count, condition: has_poll }

  - { type: uint32, name: "Quote ID", condition: quote;quote_visible }
  - { type: uint64, name: "Quote Timestamp", condition: quote;quote_visible }
  - { type: uint32, name: "Quote comment parent ID", condition: quote;quote_visible;quote_is_comment }
  - { type: str16, name: "Quote content", condition: quote;quote_visible }
  - { type: str8, name: "Quote content warning", condition: quote;quote_visible }
  - { type: str8, name: "Quote creator username", condition: quote;quote_visible }
  - { type: str8, name: "Quote creator display name", condition: quote;quote_visible }
  - { type: str8, name: "Quote creator pronouns", condition: quote;quote_visible }
  - { type: hex3, name: "Quote creator banner color 1", condition: quote;quote_visible }
  - { type: hex3, name: "Quote creator banner color 2", condition: quote;quote_visible }

POST /api/user/login:
  description: Handles logging into accounts
  id: 0x01
  version: 0
  body:
  - { type: str8, name: "Username" }
  - { type: hex32, name: "Password hash (sha256)" }
  response:
  - { type: hex32, name: "Token" }

POST /api/user/signup:
  description: Handles creating new accounts
  id: 0x02
  version: 0
  body:
  - { type: str8, name: "Username" }
  - { type: hex32, name: "Password hash (sha256)" }
  - { type: str8, name: "Invite code" }
  response:
  - { type: hex32, name: "Token" }

POST /api/user/follow:
  description: "Follows the specificed user"
  id: 0x10
  version: 0
  body:
  - { type: str0, name: "Username" }
  response:
  - { type: bool7, name: "Is pending approval" }

DELETE /api/user/follow:
  description: "Unfollows the specificed user"
  id: 0x11
  version: 0
  body:
  - { type: str0, name: "Username" }

POST /api/user/block:
  description: "Blocks the specificed user"
  id: 0x12
  version: 0
  body:
  - { type: str0, name: "Username" }

DELETE /api/user/block:
  description: "Unblocks the specificed user"
  id: 0x13
  version: 0
  body:
  - { type: str0, name: "Username" }

POST /api/user/follow-request:
  description: "Accepts a follow request from the specificed user"
  id: 0x14
  version: 0
  body:
  - { type: str0, name: "Username" }

DELETE /api/user/follow-request:
  description: "Denies a follow request from the specificed user"
  id: 0x15
  version: 0
  body:
  - { type: str0, name: "Username" }

GET /api/user:
  description: "Gets your profile information"
  id: 0x20
  version: 0
  response:
  - { type: str8, name: "Display name" }
  - { type: str16, name: "User bio" }
  - { type: str8, name: "Pronouns" }
  - { type: hex3, name: "Banner color 1" }
  - { type: hex3, name: "Banner color 2" }
  - { type: bool7, name: "Banner is gradient" }
  - { type: bool6, name: "Verify followers" }

PATCH /api/user:
  description: "Saves your profile information"
  id: 0x21
  version: 0
  body:
  - { type: bool7, name: "Banner is gradient" }
  - { type: str8, name: "Display name" }
  - { type: str16, name: "User bio" }
  - { type: str8, name: "Pronouns" }
  - { type: hex3, name: "Banner color 1" }
  - { type: hex3, name: "Banner color 2" }

DELETE /api/user:
  description: "Deletes your account"
  id: 0x22
  version: 1
  body:
  - { type: hex32, name: "Password hash (sha256)" }
  - { type: str8, name: "Username" }

PATCH /api/user/password:
  description: "Changes your password"
  id: 0x23
  version: 0
  body:
  - { type: hex32, name: "Current password hash (sha256)" }
  - { type: hex32, name: "New password hash (sha256)" }
  response:
  - { type: hex32, name: "Token" }

PATCH /api/user/default_post:
  description: "Sets the default post visibility setting"
  id: 0x24
  version: 0
  body:
  - { type: bool0, name: "Default visibility is private" }

PATCH /api/user/verify_followers:
  description: "Sets the verify followers setting"
  id: 0x25
  version: 0
  body:
  - { type: bool0, name: "Verify followers" }

POST /api/post:
  description: "Creates a post"
  id: 0x30
  version: 0
  body:
  - { type: bool7, name: "Followers only" }
  - { type: bool6, name: "Is quote", id: has_quote }
  - { type: bool5, name: "Has poll", id: has_poll }
  - { type: bool4, name: "Is comment", id: has_comment }
  - { type: str16, name: "Content" }
  - { type: str8, name: "Content warning" }
  - { type: uint8, name: "Poll items", condition: has_poll, id: poll_count }
  - { type: str8, name: "Poll option", condition: has_poll, loop: poll_count }
  - { type: uint32, name: "Quote ID", condition: has_quote }
  - { type: uint32, name: "Comment ID", condition: has_comment }

POST /api/post/like/{post_id}:
  description: "Likes a post"
  id: 0x31
  version: 0

DELETE /api/post/like/{post_id}:
  description: "Removes a like from a post"
  id: 0x32
  version: 0

POST /api/post/pin/{post_id}:
  description: "Pins a post"
  id: 0x33
  version: 0

DELETE /api/post/pin:
  description: "Unpins the pinned post"
  id: 0x34
  version: 0

POST /api/post/poll:
  description: "Votes on a poll"
  id: 0x44
  version: 0
  body:
  - { type: uint32, name: "Post ID" }
  - { type: uint8, name: "Option number" }
  response:
  - { type: uint32, name: "Post ID" }
  - { type: floatint, name: "Total votes", condition: has_poll }
  - { type: uint8, name: "Poll options", id: poll_count, condition: has_poll }
  - { type: str8, name: "Poll option", loop: poll_count, condition: has_poll }
  - { type: uint16, name: "Percentage + 1 decimal (0.0-100.0)", loop: poll_count, condition: has_poll }
  - { type: bool7, name: "Is voted for by self", loop: poll_count, condition: has_poll }

GET /api/post/poll/{post_id}:
  description: "Fetches poll data"
  id: 0x45
  version: 0
  response:
  - { type: uint32, name: "Post ID" }
  - { type: floatint, name: "Total votes", condition: has_poll }
  - { type: uint8, name: "Poll options", id: poll_count, condition: has_poll }
  - { type: str8, name: "Poll option", loop: poll_count, condition: has_poll }
  - { type: uint16, name: "Percentage + 1 decimal (0.0-100.0)", loop: poll_count, condition: has_poll }
  - { type: bool7, name: "Is voted for by self", loop: poll_count, condition: has_poll }

PATCH /api/post:
  description: "Edits a post"
  id: 0x3e
  version: 0
  body:
  - { type: uint32, name: "Post id" }
  - { type: bool7, name: "Followers only" }
  - { type: str16, name: "Content" }
  - { type: str8, name: "Content warning" }

DELETE /api/post:
  description: "Deletes a post"
  id: 0x3f
  version: 0
  body:
  - { type: uint32, name: "Post id" }
  response:
  - { type: uint32, name: "Post id" }

DELETE /api/admin/user:
  description: "Deletes an account"
  id: 0x40
  version: 0
  response:
  - { type: str0, name: "Username" }

POST /api/admin/invite:
  description: "Generates an invite code"
  id: 0x41
  version: 0
  response:
  - { type: hex32, name: "Invite code" }

DELETE /api/admin/invite:
  description: "Deletes an invite code"
  id: 0x42
  version: 0
  body:
  - { type: hex32, name: "Invite code" }

GET /api/admin/invite:
  description: "Lists all invite codes"
  id: 0x43
  version: 0
  response:
  - { type: hex32, name: "Invite code", loop: until_end }

GET /api/admin/permissions/{username}:
  description: "Gets admin permissions"
  id: 0x44
  version: 0
  response:
  - { type: bool1, name: "Can create invite codes" }
  - { type: bool7, name: "Can set admin permissions" }
  - { type: bool1, name: "Can delete users" }
  - { type: bool0, name: "Can delete posts" }

POST /api/admin/permissions:
  description: "Sets admin permissions"
  id: 0x45
  version: 0
  body:
  - { type: bool1, name: "Can create invite codes" }
  - { type: bool7, name: "Can set admin permissions" }
  - { type: bool1, name: "Can delete users" }
  - { type: bool0, name: "Can delete posts" }
  - { type: str8, name: "Username" }

GET /api/message/list:
  description: "Lists message groups you are in"
  id: 0x50
  version: 0
  params:
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Group count", id: group_count }
  - { type: int32, name: "Group ID", loop: group_count }
  - { type: int64, name: "Timestamp", loop: group_count }
  - { type: bool7, name: "Unread", loop: group_count }
  - { type: str16, name: "Recent message", loop: group_count } # will have a length of 0 if there are no messages sent
  - { type: uint8, name: "Members", id: members, loop: group_count }
  - { type: str8, name: "Member name", loop: "group_count,min(members - 1, 3)" } # excludes self - if two members (self, one other), then it would return only the other member's name. returns a maximum of three names (ex. format would be "a, b, c, and n more")

GET /api/messages/{group_id}:
  description: "Lists messages for the specified message group"
  id: 0x51
  version: 0
  params:
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Message count", id: msg_count }
  - { type: int64, name: "Timestamp", loop: msg_count }
  - { type: str16, name: "Message content", loop: msg_count }
  - { type: str8, name: "Author username", loop: msg_count }
  - { type: str8, name: "Author display name", loop: msg_count }

POST /api/message/{group_id}:
  description: "Sends a message to the specified message group"
  id: 0x52
  version: 0
  request:
  - { type: str16, name: "Message content" }
  response:
  - { type: int64, name: "Timestamp", loop: msg_count }
  - { type: str16, name: "Message content", loop: msg_count }
  - { type: str8, name: "Author display name", loop: msg_count }

GET /api/message/group:
  description: "Returns the group id for the group with the specified members"
  id: 0x53
  version: 0
  params:
    users: { type: str, name: "Comma-separated username list", required: true }
  response:
  - { type: int32, name: "Group ID", loop: group_count }

GET /api/timeline/global:
  description: "Global timeline"
  id: 0x60
  version: 0
  params:
    comments: { type: bool }
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Post count", id: post_count }
  - { type: post, name: "Post", loop: post_count }

GET /api/timeline/following:
  description: "Following timeline"
  id: 0x61
  version: 0
  params:
    comments: { type: bool }
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Post count", id: post_count }
  - { type: post, name: "Post", loop: post_count }

GET /api/timeline/user/{username}:
  description: "User timeline"
  id: 0x62
  version: 0
  params:
    offset: { type: int }
    forwards: { type: bool }
    include_comments: { type: bool }
  response:
  - { type: str8, name: "Display name" }
  - { type: str8, name: "Pronouns" }
  - { type: str16, name: "User bio" }
  - { type: hex3, name: "Banner color 1" }
  - { type: hex3, name: "Banner color 2" }
  - { type: floatint, name: "Followers count" }
  - { type: floatint, name: "Following count" }
  - { type: floatint, name: "Post count" }
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: bool5, name: "Is following" }
  - { type: bool4, name: "Is blocking" }
  - { type: bool3, name: "Has pending follow request" }
  - { type: bool2, name: "Has pinned post", id: has_pinned }
  - { type: post, name: "Pinned post", condition: has_pinned }
  - { type: uint8, name: "Post count", id: post_count }
  - { type: post, name: "Post", loop: post_count }

GET /api/timeline/post/{post_id}:
  description: "Post comments timeline"
  id: 0x63
  version: 0
  params:
    sort: { type: str, required: true }
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: post, name: "Focused post" }
  - { type: uint8, name: "Padding byte" }
  - { type: uint8, name: "Comment count", id: comment_count }
  - { type: post, name: "Comment", loop: comment_count }

GET /api/timeline/notifications:
  description: "Notification timeline"
  id: 0x64
  version: 0
  params:
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Notification count", id: notif_count }
  - { type: notif, name: "Notification", loop: notif_count }

GET /api/timeline/tag/{tag}:
  description: "Hashtag timeline"
  id: 0x65
  version: 0
  params:
    sort: { type: str, required: true }
    offset: { type: int }
    forwards: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: bool6, name: "Forwards" }
  - { type: uint8, name: "Post count", id: post_count }
  - { type: post, name: "Post", loop: post_count }

GET /api/timeline/follow-requests:
  description: "Notification timeline"
  id: 0x66
  version: 0
  params:
    offset: { type: int }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: uint8, name: "User count", id: user_count }
  - { type: uint32, name: "Offset ID", loop: user_count }
  - { type: str8, name: "Username", loop: user_count }
  - { type: str8, name: "Display name", loop: user_count }
  - { type: str16, name: "User bio", loop: user_count }

GET /api/timeline/search:
  description: "For searching"
  id: 0x67
  version: 0
  params:
    offset: { type: int }
    q: { type: str }
    cw: { type: str }
    user: { type: str }
    quote: { type: bool }
    poll: { type: bool }
    comment: { type: bool }
  response:
  - { type: bool7, name: "End of timeline" }
  - { type: uint8, name: "Post count", id: post_count }
  - { type: post, name: "Post", loop: post_count }

GET /api/notifications:
  description: "Checks for unread notifications"
  id: 0x70
  version: 0
  response:
  - { type: bool7, name: "Unread notifications" }
  - { type: bool6, name: "Unread private messages" }
  - { type: bool5, name: "Pending follow requests" }
